"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3057],{6046:(e,r,t)=>{var a=t(6658);t.o(a,"notFound")&&t.d(r,{notFound:function(){return a.notFound}}),t.o(a,"useParams")&&t.d(r,{useParams:function(){return a.useParams}}),t.o(a,"usePathname")&&t.d(r,{usePathname:function(){return a.usePathname}}),t.o(a,"useRouter")&&t.d(r,{useRouter:function(){return a.useRouter}}),t.o(a,"useSearchParams")&&t.d(r,{useSearchParams:function(){return a.useSearchParams}})},5828:(e,r,t)=>{Object.defineProperty(r,"__esModule",{value:!0}),function(e,r){for(var t in r)Object.defineProperty(e,t,{enumerable:!0,get:r[t]})}(r,{callServer:function(){return a.callServer},createServerReference:function(){return s},findSourceMapURL:function(){return n.findSourceMapURL}});let a=t(9603),n=t(3355),s=t(4979).createServerReference},57:(e,r,t)=>{t.d(r,{default:()=>o});var a=t(5155),n=t(2115),s=t(8173),l=t.n(s),i=t(8277);function o(e){let{title:r,description:t,buttonText:s,buttonHref:o,buttonPermission:d,buttonAction:c,actions:u}=e,m=s&&(o||c),g=e=>{let r="ml-3 inline-flex items-center px-4 py-2 border rounded-md shadow-sm text-sm font-medium focus:outline-none focus:ring-2 focus:ring-offset-2";switch(e){case"secondary":return"".concat(r," border-gray-300 bg-white text-gray-700 hover:bg-gray-50 focus:ring-indigo-500");case"danger":return"".concat(r," border-transparent bg-red-600 text-white hover:bg-red-700 focus:ring-red-500");default:return"".concat(r," border-transparent bg-indigo-600 text-white hover:bg-indigo-700 focus:ring-indigo-500")}},h=(0,a.jsx)("button",{onClick:c,className:g(),children:s}),x=(0,a.jsx)(l(),{href:o||"#",className:g(),children:s});return(0,a.jsxs)("div",{className:"md:flex md:items-center md:justify-between",children:[(0,a.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,a.jsx)("h2",{className:"text-2xl font-bold leading-7 text-gray-900 sm:text-3xl sm:truncate",children:r}),t&&(0,a.jsx)("p",{className:"mt-1 text-sm text-gray-500",children:t})]}),(0,a.jsxs)("div",{className:"mt-4 flex md:mt-0 md:ml-4",children:[m&&d?(0,a.jsx)(i.A,{permissions:d,children:o?x:h}):m&&(o?x:h),u&&u.map((e,r)=>{let t=(0,a.jsx)(n.Fragment,{children:e.href?(0,a.jsxs)(l(),{href:e.href,className:g(e.variant),children:[e.icon&&(0,a.jsx)("span",{className:"mr-2",children:e.icon}),e.label]}):(0,a.jsxs)("button",{onClick:e.onClick,className:g(e.variant),children:[e.icon&&(0,a.jsx)("span",{className:"mr-2",children:e.icon}),e.label]})},r);return e.permission?(0,a.jsx)(i.A,{permissions:e.permission,children:t},r):t})]})]})}},2576:(e,r,t)=>{t.d(r,{A:()=>i});var a=t(5155),n=t(2115),s=t(6046);function l(e){let{category:r,isEdit:t=!1}=e,l=(0,s.useRouter)(),i=(0,s.useSearchParams)().get("parent"),[o,d]=(0,n.useState)({parentId:null,translations:[{locale:"en",name:"",description:"",slug:"",dir:"ltr"},{locale:"ar",name:"",description:"",slug:"",dir:"rtl"}]}),[c,u]=(0,n.useState)([]),[m,g]=(0,n.useState)(!1),[h,x]=(0,n.useState)(null),[f,p]=(0,n.useState)("en");(0,n.useEffect)(()=>{(async()=>{try{let e=await fetch("/api/admin/categories?flat=true");if(!e.ok)throw Error("Failed to fetch parent categories");let a=await e.json();if(t&&r){let e=a.filter(e=>e.id!==r.id&&(!e.parentId||e.parentId!==r.id));u(e)}else u(a)}catch(e){console.error("Error fetching parent categories:",e)}})()},[r,t]),(0,n.useEffect)(()=>{if(t&&r){let e=[...r.translations];e.some(e=>"en"===e.locale)||e.push({id:"temp-".concat(Date.now(),"-en"),locale:"en",name:"",description:"",slug:"",dir:"ltr",categoryId:r.id}),e.some(e=>"ar"===e.locale)||e.push({id:"temp-".concat(Date.now(),"-ar"),locale:"ar",name:"",description:"",slug:"",dir:"rtl",categoryId:r.id}),d({parentId:r.parentId,translations:e})}else i&&d(e=>({...e,parentId:i}))},[r,t,i]);let b=(e,r,t)=>{d(a=>{let n=a.translations.map(a=>a.locale===e?{...a,[r]:t}:a);return{...a,translations:n}})},v=e=>{let r=o.translations.find(r=>r.locale===e);r&&r.name&&b(e,"slug",r.name.toLowerCase().replace(/[^\w\s]/gi,"").replace(/\s+/g,"-"))},y=async e=>{e.preventDefault(),g(!0),x(null);try{let e=o.translations.filter(e=>""!==e.name.trim());if(0===e.length)throw Error("At least one translation with a name is required");let a={...o,translations:e},n=t&&r?"/api/admin/categories/".concat(r.id):"/api/admin/categories",s=t?"PUT":"POST",i=await fetch(n,{method:s,headers:{"Content-Type":"application/json"},body:JSON.stringify(a)});if(!i.ok){let e=await i.json();throw Error(e.error||"Failed to save category")}l.push("/admin/categories")}catch(e){x(e.message||"An error occurred while saving the category"),g(!1)}},j=e=>o.translations.find(r=>r.locale===e)||{locale:e,name:"",description:"",slug:"",dir:"ar"===e?"rtl":"ltr"};return j(f),(0,a.jsxs)("form",{onSubmit:y,className:"space-y-6 bg-white p-6 rounded-md shadow-sm",children:[h&&(0,a.jsx)("div",{className:"bg-red-50 border-l-4 border-red-400 p-4 mb-4",children:(0,a.jsxs)("div",{className:"flex",children:[(0,a.jsx)("div",{className:"flex-shrink-0",children:(0,a.jsx)("svg",{className:"h-5 w-5 text-red-400",viewBox:"0 0 20 20",fill:"currentColor",children:(0,a.jsx)("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z",clipRule:"evenodd"})})}),(0,a.jsx)("div",{className:"ml-3",children:(0,a.jsx)("p",{className:"text-sm text-red-700",children:h})})]})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{htmlFor:"parent",className:"block text-sm font-medium text-gray-700",children:"Parent Category"}),(0,a.jsxs)("select",{id:"parent",name:"parent",value:o.parentId||"none",onChange:e=>{let r="none"===e.target.value?null:e.target.value;d(e=>({...e,parentId:r}))},className:"mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm rounded-md",children:[(0,a.jsx)("option",{value:"none",children:"None (Top Level)"}),c.map(e=>{var r;return(0,a.jsx)("option",{value:e.id,children:(null===(r=e.translations[0])||void 0===r?void 0:r.name)||"Unnamed Category"},e.id)})]})]}),(0,a.jsx)("div",{className:"border-b border-gray-200",children:(0,a.jsxs)("nav",{className:"-mb-px flex space-x-4","aria-label":"Translations",children:[(0,a.jsx)("button",{type:"button",onClick:()=>p("en"),className:"".concat("en"===f?"border-indigo-500 text-indigo-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"," whitespace-nowrap pb-3 px-1 border-b-2 font-medium text-sm"),children:"English"}),(0,a.jsx)("button",{type:"button",onClick:()=>p("ar"),className:"".concat("ar"===f?"border-indigo-500 text-indigo-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"," whitespace-nowrap pb-3 px-1 border-b-2 font-medium text-sm"),children:"العربية (Arabic)"})]})}),(0,a.jsx)("div",{className:"en"===f?"":"hidden",children:(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{htmlFor:"name-en",className:"block text-sm font-medium text-gray-700",children:"Name (English) *"}),(0,a.jsx)("div",{className:"mt-1",children:(0,a.jsx)("input",{type:"text",id:"name-en",value:j("en").name,onChange:e=>b("en","name",e.target.value),onBlur:()=>v("en"),className:"shadow-sm focus:ring-indigo-500 focus:border-indigo-500 block w-full sm:text-sm border-gray-300 rounded-md",required:!0})})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{htmlFor:"slug-en",className:"block text-sm font-medium text-gray-700",children:"Slug (English) *"}),(0,a.jsx)("div",{className:"mt-1",children:(0,a.jsx)("input",{type:"text",id:"slug-en",value:j("en").slug,onChange:e=>b("en","slug",e.target.value),className:"shadow-sm focus:ring-indigo-500 focus:border-indigo-500 block w-full sm:text-sm border-gray-300 rounded-md",required:!0})}),(0,a.jsx)("p",{className:"mt-1 text-xs text-gray-500",children:"Used in URLs. Click out of the name field to auto-generate."})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{htmlFor:"description-en",className:"block text-sm font-medium text-gray-700",children:"Description (English)"}),(0,a.jsx)("div",{className:"mt-1",children:(0,a.jsx)("textarea",{id:"description-en",rows:3,value:j("en").description||"",onChange:e=>b("en","description",e.target.value),className:"shadow-sm focus:ring-indigo-500 focus:border-indigo-500 block w-full sm:text-sm border-gray-300 rounded-md"})})]})]})}),(0,a.jsx)("div",{className:"ar"===f?"":"hidden",dir:"rtl",children:(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{htmlFor:"name-ar",className:"block text-sm font-medium text-gray-700",children:"الاسم (Arabic)"}),(0,a.jsx)("div",{className:"mt-1",children:(0,a.jsx)("input",{type:"text",id:"name-ar",value:j("ar").name,onChange:e=>b("ar","name",e.target.value),onBlur:()=>v("ar"),className:"shadow-sm focus:ring-indigo-500 focus:border-indigo-500 block w-full sm:text-sm border-gray-300 rounded-md"})})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{htmlFor:"slug-ar",className:"block text-sm font-medium text-gray-700",children:"الرابط (Slug)"}),(0,a.jsx)("div",{className:"mt-1",children:(0,a.jsx)("input",{type:"text",id:"slug-ar",value:j("ar").slug,onChange:e=>b("ar","slug",e.target.value),className:"shadow-sm focus:ring-indigo-500 focus:border-indigo-500 block w-full sm:text-sm border-gray-300 rounded-md"})}),(0,a.jsx)("p",{className:"mt-1 text-xs text-gray-500",children:"يستخدم في عناوين URL. انقر خارج حقل الاسم للإنشاء التلقائي."})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{htmlFor:"description-ar",className:"block text-sm font-medium text-gray-700",children:"الوصف (Description)"}),(0,a.jsx)("div",{className:"mt-1",children:(0,a.jsx)("textarea",{id:"description-ar",rows:3,value:j("ar").description||"",onChange:e=>b("ar","description",e.target.value),className:"shadow-sm focus:ring-indigo-500 focus:border-indigo-500 block w-full sm:text-sm border-gray-300 rounded-md"})})]})]})}),(0,a.jsxs)("div",{className:"flex justify-end",dir:"ltr",children:[(0,a.jsx)("button",{type:"button",onClick:()=>l.push("/admin/categories"),className:"bg-white py-2 px-4 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500",children:"Cancel"}),(0,a.jsx)("button",{type:"submit",disabled:m,className:"ml-3 inline-flex justify-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 disabled:opacity-50",children:m?"Saving...":t?"Update Category":"Create Category"})]})]})}function i(e){let[r,t]=(0,n.useState)(!1);return((0,n.useEffect)(()=>{t(!0)},[]),r)?(0,a.jsx)(l,{...e}):(0,a.jsx)("div",{children:"Loading form..."})}},8277:(e,r,t)=>{t.d(r,{A:()=>s});var a=t(5155);t(2115);var n=t(5202);function s(e){let{permissions:r,type:t="any",fallback:s=null,children:l}=e,{hasPermission:i,hasAllPermissions:o,hasAnyPermissions:d,loading:c}=(0,n.A)(),u=Array.isArray(r)?r:[r];return c?null:("all"===t?o(u):d(u))?(0,a.jsx)(a.Fragment,{children:l}):(0,a.jsx)(a.Fragment,{children:s})}},1330:(e,r,t)=>{t.d(r,{A:()=>s});var a=t(5155);t(2115);var n=t(5202);function s(e){let{roles:r,type:t="any",fallback:s=null,children:l}=e,{user:i,loading:o}=(0,n.A)(),d=Array.isArray(r)?r:[r];return o?null:i&&i.roles?("all"===t?d.every(e=>i.roles.includes(e)):d.some(e=>i.roles.includes(e)))?(0,a.jsx)(a.Fragment,{children:l}):(0,a.jsx)(a.Fragment,{children:s}):(0,a.jsx)(a.Fragment,{children:s})}},5202:(e,r,t)=>{t.d(r,{AuthProvider:()=>d,A:()=>o});var a=t(5155),n=t(2115),s=t(5828);let l=(0,s.createServerReference)("00d4248e5cc13d9a24c27da7f63c4e748a633f8d0d",s.callServer,void 0,s.findSourceMapURL,"logout"),i=(0,n.createContext)(void 0);function o(){let e=(0,n.useContext)(i);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}function d(e){let{children:r}=e,[t,s]=(0,n.useState)(null),[o,d]=(0,n.useState)(!0),[c,u]=(0,n.useState)(null),m=(0,n.useCallback)(async()=>{try{u(null);let e=await fetch("/api/auth/me",{credentials:"include",cache:"no-store"});if(e.ok)return await e.json();if(401===e.status)return null;throw Error("Failed to fetch user data")}catch(e){return console.error("Failed to load user:",e),u(e instanceof Error?e.message:"Failed to load user"),null}},[]),g=(0,n.useCallback)(async()=>{s(await m())},[m]);(0,n.useEffect)(()=>{let e=!0;return(async()=>{let r=await m();e&&(s(r),d(!1))})(),()=>{e=!1}},[m]);let h=(0,n.useCallback)(e=>!!t&&(!!(t.roles.includes("ADMIN")||t.roles.includes("SUPER_ADMIN"))||t.permissions.includes(e)),[t]),x=(0,n.useCallback)(e=>e.some(e=>h(e)),[h]),f=(0,n.useCallback)(e=>e.every(e=>h(e)),[h]),p=(0,n.useCallback)(async()=>{try{u(null),await l(),s(null),window.location.href="/admin/login"}catch(e){console.error("Logout failed:",e),u(e instanceof Error?e.message:"Logout failed")}},[]),b=n.useMemo(()=>({user:t,loading:o,error:c,setUser:s,hasPermission:h,hasAnyPermissions:x,hasAllPermissions:f,logout:p,refreshUser:g}),[t,o,c,h,x,f,p,g]);return(0,a.jsx)(i.Provider,{value:b,children:r})}}}]);