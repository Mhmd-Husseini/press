(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3848],{5045:(e,s,r)=>{Promise.resolve().then(r.bind(r,5387))},5828:(e,s,r)=>{"use strict";Object.defineProperty(s,"__esModule",{value:!0}),function(e,s){for(var r in s)Object.defineProperty(e,r,{enumerable:!0,get:s[r]})}(s,{callServer:function(){return i.callServer},createServerReference:function(){return a},findSourceMapURL:function(){return t.findSourceMapURL}});let i=r(9603),t=r(3355),a=r(4979).createServerReference},5387:(e,s,r)=>{"use strict";r.r(s),r.d(s,{default:()=>n});var i=r(5155),t=r(2115),a=r(8277);function n(){let[e,s]=(0,t.useState)([]),[r,n]=(0,t.useState)([]),[l,o]=(0,t.useState)(!0),[d,c]=(0,t.useState)(null),[m,u]=(0,t.useState)({name:"",nameArabic:"",description:"",descriptionArabic:"",permissions:[]});(0,t.useEffect)(()=>{!async function(){try{o(!0);let e=await fetch("/api/admin/roles");if(!e.ok)throw Error("Failed to fetch roles");let r=await e.json(),i=await fetch("/api/admin/permissions");if(!i.ok)throw Error("Failed to fetch permissions");let t=await i.json();s(r),n(t)}catch(e){c(e instanceof Error?e.message:"An unknown error occurred")}finally{o(!1)}}()},[]);let x=e=>{let{name:s,value:r}=e.target;u(e=>({...e,[s]:r}))},h=e=>{let{value:s,checked:r}=e.target;u(e=>r?{...e,permissions:[...e.permissions,s]}:{...e,permissions:e.permissions.filter(e=>e!==s)})},f=async e=>{e.preventDefault();try{let e=await fetch("/api/admin/roles",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(m)});if(!e.ok){let s=await e.json();throw Error(s.message||"Failed to create role")}let r=await e.json();s(e=>[...e,r]),u({name:"",nameArabic:"",description:"",descriptionArabic:"",permissions:[]})}catch(e){c(e instanceof Error?e.message:"An unknown error occurred")}},g=async e=>{if(window.confirm("Are you sure you want to delete this role?"))try{if(!(await fetch("/api/admin/roles/".concat(e),{method:"DELETE"})).ok)throw Error("Failed to delete role");s(s=>s.filter(s=>s.id!==e))}catch(e){c(e instanceof Error?e.message:"An unknown error occurred")}};return l?(0,i.jsx)("div",{className:"p-4 text-center",children:"Loading roles..."}):d?(0,i.jsx)("div",{className:"p-4 text-red-500",children:d}):(0,i.jsx)(a.A,{permissions:["view_roles","manage_roles"],fallback:(0,i.jsx)("div",{className:"p-4",children:"You don't have permission to view this page."}),children:(0,i.jsxs)("div",{className:"bg-white rounded-lg shadow p-6",children:[(0,i.jsx)("h1",{className:"text-2xl font-bold mb-6",children:"Roles Management"}),(0,i.jsx)(a.A,{permissions:"create_roles",children:(0,i.jsxs)("div",{className:"mb-8 bg-gray-50 p-4 rounded-lg",children:[(0,i.jsx)("h2",{className:"text-lg font-semibold mb-4",children:"Create New Role"}),(0,i.jsxs)("form",{onSubmit:f,className:"space-y-4",children:[(0,i.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,i.jsxs)("div",{children:[(0,i.jsx)("label",{htmlFor:"name",className:"block text-sm font-medium text-gray-700 mb-1",children:"Name *"}),(0,i.jsx)("input",{type:"text",id:"name",name:"name",value:m.name,onChange:x,required:!0,className:"w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm",placeholder:"EDITOR"})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)("label",{htmlFor:"nameArabic",className:"block text-sm font-medium text-gray-700 mb-1",children:"Name (Arabic)"}),(0,i.jsx)("input",{type:"text",id:"nameArabic",name:"nameArabic",value:m.nameArabic,onChange:x,className:"w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm",dir:"rtl"})]})]}),(0,i.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,i.jsxs)("div",{children:[(0,i.jsx)("label",{htmlFor:"description",className:"block text-sm font-medium text-gray-700 mb-1",children:"Description"}),(0,i.jsx)("textarea",{id:"description",name:"description",value:m.description,onChange:x,rows:3,className:"w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm",placeholder:"Editors can create and edit content"})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)("label",{htmlFor:"descriptionArabic",className:"block text-sm font-medium text-gray-700 mb-1",children:"Description (Arabic)"}),(0,i.jsx)("textarea",{id:"descriptionArabic",name:"descriptionArabic",value:m.descriptionArabic,onChange:x,rows:3,className:"w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm",dir:"rtl"})]})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Permissions"}),(0,i.jsx)("div",{className:"bg-white p-3 border rounded-md max-h-60 overflow-y-auto",children:(0,i.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3",children:r.map(e=>(0,i.jsxs)("div",{className:"flex items-start",children:[(0,i.jsx)("div",{className:"flex items-center h-5",children:(0,i.jsx)("input",{id:"permission-".concat(e.id),type:"checkbox",value:e.name,checked:m.permissions.includes(e.name),onChange:h,className:"focus:ring-indigo-500 h-4 w-4 text-indigo-600 border-gray-300 rounded"})}),(0,i.jsxs)("div",{className:"ml-3 text-sm",children:[(0,i.jsx)("label",{htmlFor:"permission-".concat(e.id),className:"font-medium text-gray-700",children:e.name}),e.description&&(0,i.jsx)("p",{className:"text-gray-500",children:e.description})]})]},e.id))})})]}),(0,i.jsx)("div",{className:"flex justify-end",children:(0,i.jsx)("button",{type:"submit",className:"inline-flex justify-center py-2 px-4 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500",children:"Create Role"})})]})]})}),(0,i.jsxs)("div",{children:[(0,i.jsx)("h2",{className:"text-lg font-semibold mb-4",children:"All Roles"}),0===e.length?(0,i.jsx)("p",{className:"text-gray-500",children:"No roles found."}):(0,i.jsx)("div",{className:"space-y-6",children:e.map(e=>(0,i.jsxs)("div",{className:"bg-white border rounded-lg overflow-hidden",children:[(0,i.jsxs)("div",{className:"bg-gray-50 px-4 py-3 border-b flex justify-between items-center",children:[(0,i.jsxs)("div",{children:[(0,i.jsx)("h3",{className:"text-lg font-medium text-gray-900",children:e.name}),e.nameArabic&&(0,i.jsx)("p",{className:"text-sm text-gray-500",dir:"rtl",children:e.nameArabic})]}),(0,i.jsxs)("div",{className:"flex space-x-2",children:[(0,i.jsx)(a.A,{permissions:"edit_roles",children:(0,i.jsx)("a",{href:"/admin/roles/edit/".concat(e.id),className:"inline-flex items-center px-3 py-1 border border-transparent text-sm font-medium rounded-md text-indigo-700 bg-indigo-100 hover:bg-indigo-200",children:"Edit"})}),(0,i.jsx)(a.A,{permissions:"delete_roles",children:(0,i.jsx)("button",{onClick:()=>g(e.id),className:"inline-flex items-center px-3 py-1 border border-transparent text-sm font-medium rounded-md text-red-700 bg-red-100 hover:bg-red-200",children:"Delete"})})]})]}),(0,i.jsxs)("div",{className:"p-4",children:[e.description&&(0,i.jsxs)("div",{className:"mb-4",children:[(0,i.jsx)("h4",{className:"text-sm font-medium text-gray-700 mb-1",children:"Description:"}),(0,i.jsx)("p",{className:"text-sm text-gray-500",children:e.description}),e.descriptionArabic&&(0,i.jsx)("p",{className:"text-sm text-gray-500 mt-1",dir:"rtl",children:e.descriptionArabic})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)("h4",{className:"text-sm font-medium text-gray-700 mb-2",children:"Permissions:"}),0===e.permissions.length?(0,i.jsx)("p",{className:"text-sm text-gray-500",children:"No permissions assigned."}):(0,i.jsx)("div",{className:"flex flex-wrap gap-2",children:e.permissions.map(e=>{let{permission:s}=e;return(0,i.jsx)("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800",children:s.name},s.id)})})]})]})]},e.id))})]})]})})}},8277:(e,s,r)=>{"use strict";r.d(s,{A:()=>a});var i=r(5155);r(2115);var t=r(5202);function a(e){let{permissions:s,type:r="any",fallback:a=null,children:n}=e,{hasPermission:l,hasAllPermissions:o,hasAnyPermissions:d,loading:c}=(0,t.A)(),m=Array.isArray(s)?s:[s];return c?null:("all"===r?o(m):d(m))?(0,i.jsx)(i.Fragment,{children:n}):(0,i.jsx)(i.Fragment,{children:a})}},5202:(e,s,r)=>{"use strict";r.d(s,{AuthProvider:()=>d,A:()=>o});var i=r(5155),t=r(2115),a=r(5828);let n=(0,a.createServerReference)("00d4248e5cc13d9a24c27da7f63c4e748a633f8d0d",a.callServer,void 0,a.findSourceMapURL,"logout"),l=(0,t.createContext)(void 0);function o(){let e=(0,t.useContext)(l);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}function d(e){let{children:s}=e,[r,a]=(0,t.useState)(null),[o,d]=(0,t.useState)(!0),[c,m]=(0,t.useState)(null),u=(0,t.useCallback)(async()=>{try{m(null);let e=await fetch("/api/auth/me",{credentials:"include",cache:"no-store"});if(e.ok)return await e.json();if(401===e.status)return null;throw Error("Failed to fetch user data")}catch(e){return console.error("Failed to load user:",e),m(e instanceof Error?e.message:"Failed to load user"),null}},[]),x=(0,t.useCallback)(async()=>{a(await u())},[u]);(0,t.useEffect)(()=>{let e=!0;return(async()=>{let s=await u();e&&(a(s),d(!1))})(),()=>{e=!1}},[u]);let h=(0,t.useCallback)(e=>!!r&&(!!(r.roles.includes("ADMIN")||r.roles.includes("SUPER_ADMIN"))||r.permissions.includes(e)),[r]),f=(0,t.useCallback)(e=>e.some(e=>h(e)),[h]),g=(0,t.useCallback)(e=>e.every(e=>h(e)),[h]),p=(0,t.useCallback)(async()=>{try{m(null),await n(),a(null),window.location.href="/admin/login"}catch(e){console.error("Logout failed:",e),m(e instanceof Error?e.message:"Logout failed")}},[]),b=t.useMemo(()=>({user:r,loading:o,error:c,setUser:a,hasPermission:h,hasAnyPermissions:f,hasAllPermissions:g,logout:p,refreshUser:x}),[r,o,c,h,f,g,p,x]);return(0,i.jsx)(l.Provider,{value:b,children:s})}}},e=>{var s=s=>e(e.s=s);e.O(0,[8441,1517,7358],()=>s(5045)),_N_E=e.O()}]);