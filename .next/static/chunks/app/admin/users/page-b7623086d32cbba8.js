(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8733],{780:(e,r,t)=>{Promise.resolve().then(t.bind(t,4037))},6046:(e,r,t)=>{"use strict";var s=t(6658);t.o(s,"notFound")&&t.d(r,{notFound:function(){return s.notFound}}),t.o(s,"useParams")&&t.d(r,{useParams:function(){return s.useParams}}),t.o(s,"usePathname")&&t.d(r,{usePathname:function(){return s.usePathname}}),t.o(s,"useRouter")&&t.d(r,{useRouter:function(){return s.useRouter}}),t.o(s,"useSearchParams")&&t.d(r,{useSearchParams:function(){return s.useSearchParams}})},5828:(e,r,t)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),function(e,r){for(var t in r)Object.defineProperty(e,t,{enumerable:!0,get:r[t]})}(r,{callServer:function(){return s.callServer},createServerReference:function(){return n},findSourceMapURL:function(){return a.findSourceMapURL}});let s=t(9603),a=t(3355),n=t(4979).createServerReference},4037:(e,r,t)=>{"use strict";t.r(r),t.d(r,{default:()=>f});var s=t(5155),a=t(5828);let n=(0,a.createServerReference)("70bcc105acf56993e9fa771860505741269129801f",a.callServer,void 0,a.findSourceMapURL,"getUsers");var l=t(8173),i=t.n(l);let d=(0,a.createServerReference)("4088416fcca4e2f0fd31c02635f52bcd85eb0c7428",a.callServer,void 0,a.findSourceMapURL,"deleteUser");var c=t(2115),o=t(6214),u=t(6046),m=t(5202);function x(e){let{users:r,meta:t,basePath:a="/admin/users",allowEditing:n}=e,l=(0,u.useRouter)(),[x,h]=(0,c.useState)(null),[g,f]=(0,c.useState)(null),{user:b}=(0,m.A)(),p=()=>!n||!b||!b.roles||n.some(e=>b.roles.includes(e)),v=async e=>{if(confirm("Are you sure you want to delete this user?")){h(e),f(null);try{let r=await d(e);r.success?l.refresh():f(r.error||"Failed to delete user")}catch(e){f("An unexpected error occurred"),console.error(e)}finally{h(null)}}},y=[{key:"firstName",label:"Name",sortable:!0,render:(e,r)=>(0,s.jsxs)("div",{className:"text-sm font-medium text-gray-900",children:[r.firstName," ",r.lastName]})},{key:"email",label:"Email",sortable:!0,render:e=>(0,s.jsx)("div",{className:"text-sm text-gray-500",children:e})},{key:"roles",label:"Roles",render:e=>(0,s.jsx)("div",{className:"flex flex-wrap gap-1",children:e&&Array.isArray(e)&&e.map((e,r)=>(0,s.jsx)("span",{className:"px-2 py-1 text-xs font-medium rounded-full bg-blue-100 text-blue-800",children:e.role.name},r))})},{key:"isActive",label:"Status",render:e=>(0,s.jsx)("span",{className:"px-2 py-1 text-xs font-medium rounded-full ".concat(e?"bg-green-100 text-green-800":"bg-red-100 text-red-800"),children:e?"Active":"Inactive"})},{key:"createdAt",label:"Created At",sortable:!0,render:e=>(0,s.jsx)("div",{className:"text-sm text-gray-500",children:new Date(e).toLocaleDateString()})},{key:"id",label:"Actions",render:(e,r)=>(0,s.jsxs)("div",{className:"flex justify-end gap-2",children:[(0,s.jsx)(i(),{href:"/admin/users/".concat(r.id),className:"text-indigo-600 hover:text-indigo-900",children:"View"}),p()&&(0,s.jsx)(i(),{href:"/admin/users/".concat(r.id,"/edit"),className:"text-blue-600 hover:text-blue-900",children:"Edit"}),p()&&(0,s.jsx)("button",{onClick:()=>v(r.id),disabled:x===r.id,className:"text-red-600 hover:text-red-900 disabled:opacity-50",children:x===r.id?"Deleting...":"Delete"})]})}];return(0,s.jsxs)("div",{children:[g&&(0,s.jsx)("div",{className:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded-lg mb-4",children:g}),(0,s.jsx)(o.b,{columns:y,data:r,total:(null==t?void 0:t.total)||r.length,page:(null==t?void 0:t.page)||1,limit:(null==t?void 0:t.limit)||10,onPageChange:e=>{let r=new URLSearchParams(window.location.search);r.set("page",e.toString()),l.push("".concat(a,"?").concat(r.toString()))},onLimitChange:e=>{let r=new URLSearchParams(window.location.search);r.set("limit",e.toString()),r.set("page","1"),l.push("".concat(a,"?").concat(r.toString()))},onSearch:e=>{let r=new URLSearchParams(window.location.search);e?r.set("search",e):r.delete("search"),r.set("page","1"),l.push("".concat(a,"?").concat(r.toString()))}})]})}var h=t(1330);function g(){let e=(0,u.useSearchParams)(),[r,t]=(0,c.useState)([]),[a,l]=(0,c.useState)(null),[d,o]=(0,c.useState)(!0),[m,g]=(0,c.useState)(null),f=parseInt(e.get("page")||"1"),b=parseInt(e.get("limit")||"10"),p=e.get("search")||"";(0,c.useEffect)(()=>{!async function(){try{o(!0);let e=await n(f,b,p);e.success?(t(e.users||[]),l(e.meta),g(null)):(g(e.error||"Failed to load users"),t([]))}catch(e){g("An unexpected error occurred"),console.error(e)}finally{o(!1)}}()},[f,b,p]);let v=(0,s.jsxs)("div",{className:"bg-red-50 border border-red-200 text-red-700 px-6 py-8 rounded-lg text-center",children:[(0,s.jsx)("h3",{className:"text-lg font-medium",children:"Access Denied"}),(0,s.jsx)("p",{className:"mt-2",children:"You don't have permission to view the user management section."}),(0,s.jsx)(i(),{href:"/admin",className:"mt-4 inline-block text-blue-600 hover:underline",children:"Return to Admin Dashboard"})]});return(0,s.jsx)(h.A,{roles:["SUPER_ADMIN","EDITOR_IN_CHIEF","EDITORIAL","SENIOR_EDITOR"],fallback:v,children:(0,s.jsxs)("div",{className:"space-y-6",children:[(0,s.jsxs)("div",{className:"flex justify-between items-center",children:[(0,s.jsx)("h1",{className:"text-2xl font-bold",children:"User Management"}),(0,s.jsx)(h.A,{roles:["SUPER_ADMIN","EDITOR_IN_CHIEF","EDITORIAL"],children:(0,s.jsx)(i(),{href:"/admin/users/new",className:"bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700",children:"Add New User"})})]}),d?(0,s.jsx)("div",{className:"flex justify-center py-6",children:(0,s.jsx)("div",{className:"animate-spin rounded-full h-10 w-10 border-b-2 border-blue-600"})}):m?(0,s.jsx)("div",{className:"bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-lg",children:(0,s.jsxs)("p",{children:["Error loading users: ",m]})}):r&&r.length>0?(0,s.jsx)(x,{users:r,meta:a,basePath:"/admin/users",allowEditing:["SUPER_ADMIN","EDITOR_IN_CHIEF","EDITORIAL"]}):(0,s.jsxs)("div",{className:"text-center py-10 bg-gray-50 rounded-lg",children:[(0,s.jsx)("h3",{className:"text-lg font-medium text-gray-900",children:"No users found"}),(0,s.jsx)("p",{className:"mt-1 text-gray-500",children:p?'No users match "'.concat(p,'"'):"There are no users in the system yet."}),p&&(0,s.jsx)(i(),{href:"/admin/users",className:"mt-4 inline-block text-blue-600 hover:underline",children:"Clear search"})]})]})})}function f(){return(0,s.jsx)(c.Suspense,{fallback:(0,s.jsx)("div",{className:"flex justify-center py-6",children:(0,s.jsx)("div",{className:"animate-spin rounded-full h-10 w-10 border-b-2 border-blue-600"})}),children:(0,s.jsx)(g,{})})}},1330:(e,r,t)=>{"use strict";t.d(r,{A:()=>n});var s=t(5155);t(2115);var a=t(5202);function n(e){let{roles:r,type:t="any",fallback:n=null,children:l}=e,{user:i,loading:d}=(0,a.A)(),c=Array.isArray(r)?r:[r];return d?null:i&&i.roles?("all"===t?c.every(e=>i.roles.includes(e)):c.some(e=>i.roles.includes(e)))?(0,s.jsx)(s.Fragment,{children:l}):(0,s.jsx)(s.Fragment,{children:n}):(0,s.jsx)(s.Fragment,{children:n})}},6214:(e,r,t)=>{"use strict";t.d(r,{b:()=>d});var s=t(5155),a=t(2115),n=t(7721);let l=a.forwardRef(function(e,r){let{title:t,titleId:s,...n}=e;return a.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:r,"aria-labelledby":s},n),t?a.createElement("title",{id:s},t):null,a.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m4.5 15.75 7.5-7.5 7.5 7.5"}))});var i=t(6441);function d(e){let{columns:r,data:t,total:d,page:c,limit:o,onPageChange:u,onLimitChange:m,onSort:x,onSearch:h,onFilter:g,loading:f=!1,searchPlaceholder:b="Search..."}=e,[p,v]=(0,a.useState)(null),[y,j]=(0,a.useState)("asc"),[N,w]=(0,a.useState)(""),S=e=>{let r=p===e&&"asc"===y?"desc":"asc";v(e),j(r),null==x||x(e,r)},k=e=>{w(e),null==h||h(e)},A=Math.ceil(d/o),E=Math.min(c*o,d);return(0,s.jsxs)("div",{className:"bg-white shadow rounded-lg",children:[h&&(0,s.jsx)("div",{className:"p-4 border-b border-gray-200",children:(0,s.jsxs)("div",{className:"relative max-w-md",children:[(0,s.jsx)("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:(0,s.jsx)(n.A,{className:"h-5 w-5 text-gray-400"})}),(0,s.jsx)("input",{type:"text",placeholder:b,value:N,onChange:e=>k(e.target.value),className:"block w-full pl-10 pr-3 py-2 border border-gray-300 rounded-md leading-5 bg-white placeholder-gray-500 focus:outline-none focus:placeholder-gray-400 focus:ring-1 focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm"})]})}),(0,s.jsx)("div",{className:"overflow-x-auto",children:(0,s.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[(0,s.jsx)("thead",{className:"bg-gray-50",children:(0,s.jsx)("tr",{children:r.map(e=>(0,s.jsx)("th",{onClick:()=>e.sortable&&S(e.key),className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider ".concat(e.sortable?"cursor-pointer hover:bg-gray-100":""," ").concat(e.className||""),children:(0,s.jsxs)("div",{className:"flex items-center space-x-1",children:[(0,s.jsx)("span",{children:e.label}),e.sortable&&(0,s.jsxs)("div",{className:"flex flex-col",children:[(0,s.jsx)(l,{className:"h-3 w-3 ".concat(p===e.key&&"asc"===y?"text-indigo-600":"text-gray-300")}),(0,s.jsx)(i.A,{className:"h-3 w-3 -mt-1 ".concat(p===e.key&&"desc"===y?"text-indigo-600":"text-gray-300")})]})]})},String(e.key)))})}),(0,s.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:f?(0,s.jsx)("tr",{children:(0,s.jsx)("td",{colSpan:r.length,className:"px-6 py-12 text-center",children:(0,s.jsx)("div",{className:"flex justify-center",children:(0,s.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-indigo-600"})})})}):0===t.length?(0,s.jsx)("tr",{children:(0,s.jsx)("td",{colSpan:r.length,className:"px-6 py-12 text-center text-gray-500",children:"No data found"})}):t.map((e,t)=>(0,s.jsx)("tr",{className:"hover:bg-gray-50",children:r.map(r=>(0,s.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:r.render?r.render(e[r.key],e):String(e[r.key]||"")},String(r.key)))},t))})]})}),(0,s.jsxs)("div",{className:"bg-white px-4 py-3 flex items-center justify-between border-t border-gray-200 sm:px-6",children:[(0,s.jsxs)("div",{className:"flex-1 flex justify-between sm:hidden",children:[(0,s.jsx)("button",{onClick:()=>u(c-1),disabled:c<=1,className:"relative inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed",children:"Previous"}),(0,s.jsx)("button",{onClick:()=>u(c+1),disabled:c>=A,className:"ml-3 relative inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed",children:"Next"})]}),(0,s.jsxs)("div",{className:"hidden sm:flex-1 sm:flex sm:items-center sm:justify-between",children:[(0,s.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,s.jsxs)("p",{className:"text-sm text-gray-700",children:["Showing ",(0,s.jsx)("span",{className:"font-medium",children:(c-1)*o+1})," to"," ",(0,s.jsx)("span",{className:"font-medium",children:E})," of"," ",(0,s.jsx)("span",{className:"font-medium",children:d})," results"]}),(0,s.jsxs)("select",{value:o,onChange:e=>m(Number(e.target.value)),className:"border border-gray-300 rounded-md text-sm px-2 py-1 focus:outline-none focus:ring-1 focus:ring-indigo-500 focus:border-indigo-500",children:[(0,s.jsx)("option",{value:10,children:"10 per page"}),(0,s.jsx)("option",{value:25,children:"25 per page"}),(0,s.jsx)("option",{value:50,children:"50 per page"}),(0,s.jsx)("option",{value:100,children:"100 per page"})]})]}),(0,s.jsx)("div",{children:(0,s.jsxs)("nav",{className:"relative z-0 inline-flex rounded-md shadow-sm -space-x-px","aria-label":"Pagination",children:[(0,s.jsx)("button",{onClick:()=>u(c-1),disabled:c<=1,className:"relative inline-flex items-center px-2 py-2 rounded-l-md border border-gray-300 bg-white text-sm font-medium text-gray-500 hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed",children:"Previous"}),A>1&&(()=>{let e=[],r=[];for(let r=Math.max(2,c-2);r<=Math.min(A-1,c+2);r++)e.push(r);return c-2>2?r.push(1,"..."):r.push(1),r.push(...e),c+2<A-1?r.push("...",A):r.push(A),r})().map((e,r)=>"..."===e?(0,s.jsx)("span",{className:"relative inline-flex items-center px-4 py-2 border border-gray-300 bg-white text-sm font-medium text-gray-700",children:"..."},r):(0,s.jsx)("button",{onClick:()=>u(e),className:"relative inline-flex items-center px-4 py-2 border text-sm font-medium ".concat(c===e?"z-10 bg-indigo-50 border-indigo-500 text-indigo-600":"bg-white border-gray-300 text-gray-500 hover:bg-gray-50"),children:e},r)),(0,s.jsx)("button",{onClick:()=>u(c+1),disabled:c>=A,className:"relative inline-flex items-center px-2 py-2 rounded-r-md border border-gray-300 bg-white text-sm font-medium text-gray-500 hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed",children:"Next"})]})})]})]})]})}},5202:(e,r,t)=>{"use strict";t.d(r,{AuthProvider:()=>c,A:()=>d});var s=t(5155),a=t(2115),n=t(5828);let l=(0,n.createServerReference)("00d4248e5cc13d9a24c27da7f63c4e748a633f8d0d",n.callServer,void 0,n.findSourceMapURL,"logout"),i=(0,a.createContext)(void 0);function d(){let e=(0,a.useContext)(i);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}function c(e){let{children:r}=e,[t,n]=(0,a.useState)(null),[d,c]=(0,a.useState)(!0),[o,u]=(0,a.useState)(null),m=(0,a.useCallback)(async()=>{try{u(null);let e=await fetch("/api/auth/me",{credentials:"include",cache:"no-store"});if(e.ok)return await e.json();if(401===e.status)return null;throw Error("Failed to fetch user data")}catch(e){return console.error("Failed to load user:",e),u(e instanceof Error?e.message:"Failed to load user"),null}},[]),x=(0,a.useCallback)(async()=>{n(await m())},[m]);(0,a.useEffect)(()=>{let e=!0;return(async()=>{let r=await m();e&&(n(r),c(!1))})(),()=>{e=!1}},[m]);let h=(0,a.useCallback)(e=>!!t&&(!!(t.roles.includes("ADMIN")||t.roles.includes("SUPER_ADMIN"))||t.permissions.includes(e)),[t]),g=(0,a.useCallback)(e=>e.some(e=>h(e)),[h]),f=(0,a.useCallback)(e=>e.every(e=>h(e)),[h]),b=(0,a.useCallback)(async()=>{try{u(null),await l(),n(null),window.location.href="/admin/login"}catch(e){console.error("Logout failed:",e),u(e instanceof Error?e.message:"Logout failed")}},[]),p=a.useMemo(()=>({user:t,loading:d,error:o,setUser:n,hasPermission:h,hasAnyPermissions:g,hasAllPermissions:f,logout:b,refreshUser:x}),[t,d,o,h,g,f,b,x]);return(0,s.jsx)(i.Provider,{value:p,children:r})}},6441:(e,r,t)=>{"use strict";t.d(r,{A:()=>a});var s=t(2115);let a=s.forwardRef(function(e,r){let{title:t,titleId:a,...n}=e;return s.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:r,"aria-labelledby":a},n),t?s.createElement("title",{id:a},t):null,s.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m19.5 8.25-7.5 7.5-7.5-7.5"}))})},7721:(e,r,t)=>{"use strict";t.d(r,{A:()=>a});var s=t(2115);let a=s.forwardRef(function(e,r){let{title:t,titleId:a,...n}=e;return s.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:r,"aria-labelledby":a},n),t?s.createElement("title",{id:a},t):null,s.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m21 21-5.197-5.197m0 0A7.5 7.5 0 1 0 5.196 5.196a7.5 7.5 0 0 0 10.607 10.607Z"}))})}},e=>{var r=r=>e(e.s=r);e.O(0,[8173,8441,1517,7358],()=>r(780)),_N_E=e.O()}]);