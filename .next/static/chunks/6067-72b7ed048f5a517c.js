"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6067],{6046:(e,r,a)=>{var s=a(6658);a.o(s,"notFound")&&a.d(r,{notFound:function(){return s.notFound}}),a.o(s,"useParams")&&a.d(r,{useParams:function(){return s.useParams}}),a.o(s,"usePathname")&&a.d(r,{usePathname:function(){return s.usePathname}}),a.o(s,"useRouter")&&a.d(r,{useRouter:function(){return s.useRouter}}),a.o(s,"useSearchParams")&&a.d(r,{useSearchParams:function(){return s.useSearchParams}})},5828:(e,r,a)=>{Object.defineProperty(r,"__esModule",{value:!0}),function(e,r){for(var a in r)Object.defineProperty(e,a,{enumerable:!0,get:r[a]})}(r,{callServer:function(){return s.callServer},createServerReference:function(){return t},findSourceMapURL:function(){return l.findSourceMapURL}});let s=a(9603),l=a(3355),t=a(4979).createServerReference},1330:(e,r,a)=>{a.d(r,{A:()=>t});var s=a(5155);a(2115);var l=a(5202);function t(e){let{roles:r,type:a="any",fallback:t=null,children:o}=e,{user:n,loading:d}=(0,l.A)(),i=Array.isArray(r)?r:[r];return d?null:n&&n.roles?("all"===a?i.every(e=>n.roles.includes(e)):i.some(e=>n.roles.includes(e)))?(0,s.jsx)(s.Fragment,{children:o}):(0,s.jsx)(s.Fragment,{children:t}):(0,s.jsx)(s.Fragment,{children:t})}},2740:(e,r,a)=>{a.d(r,{A:()=>o});var s=a(5155),l=a(6046),t=a(2115);function o(e){var r;let{user:a,onSubmit:o,submitButtonText:n}=e,d=(0,l.useRouter)(),[i,c]=(0,t.useState)(!1),[u,m]=(0,t.useState)(null),[b,f]=(0,t.useState)([]),[x,h]=(0,t.useState)(!0),[p,g]=(0,t.useState)((null==a?void 0:null===(r=a.roles)||void 0===r?void 0:r.map(e=>e.role.name))||["USER"]);(0,t.useEffect)(()=>{!async function(){try{h(!0);let e=await fetch("/api/admin/roles");if(!e.ok)throw Error("Failed to fetch roles");let r=await e.json();f(r)}catch(e){console.error("Error fetching roles:",e),m("Failed to load roles. Using default roles instead."),f([{id:"1",name:"ADMIN",description:"Administrator"},{id:"2",name:"USER",description:"Regular user"},{id:"3",name:"EDITOR",description:"Content editor"}])}finally{h(!1)}}()},[]);let v=async e=>{e.preventDefault(),c(!0),m(null);try{let r=new FormData(e.currentTarget);r.set("roles",p.join(",")),(null==a?void 0:a.id)&&r.set("id",a.id);let s=await o(r);s.success?(d.push("/dashboard/users"),d.refresh()):m(s.error||"An error occurred")}catch(e){m("An unexpected error occurred"),console.error(e)}finally{c(!1)}},y=e=>{g(r=>r.includes(e)?r.filter(r=>r!==e):[...r,e])};return(0,s.jsxs)("form",{onSubmit:v,className:"space-y-6",children:[u&&(0,s.jsx)("div",{className:"bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-lg",children:u}),(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsx)("h3",{className:"text-lg font-medium",children:"Basic Information"}),(0,s.jsxs)("div",{children:[(0,s.jsxs)("label",{htmlFor:"email",className:"block text-sm font-medium text-gray-700",children:["Email ",(0,s.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,s.jsx)("input",{type:"email",id:"email",name:"email",defaultValue:(null==a?void 0:a.email)||"",required:!0,className:"mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500"})]}),(0,s.jsxs)("div",{children:[(0,s.jsxs)("label",{htmlFor:"firstName",className:"block text-sm font-medium text-gray-700",children:["First Name ",(0,s.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,s.jsx)("input",{type:"text",id:"firstName",name:"firstName",defaultValue:(null==a?void 0:a.firstName)||"",required:!0,className:"mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500"})]}),(0,s.jsxs)("div",{children:[(0,s.jsxs)("label",{htmlFor:"lastName",className:"block text-sm font-medium text-gray-700",children:["Last Name ",(0,s.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,s.jsx)("input",{type:"text",id:"lastName",name:"lastName",defaultValue:(null==a?void 0:a.lastName)||"",required:!0,className:"mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500"})]}),(0,s.jsxs)("div",{children:[(0,s.jsxs)("label",{htmlFor:"password",className:"block text-sm font-medium text-gray-700",children:["Password ",!a&&(0,s.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,s.jsx)("input",{type:"password",id:"password",name:"password",required:!a,className:"mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500"}),a&&(0,s.jsx)("p",{className:"mt-1 text-sm text-gray-500",children:"Leave blank to keep current password"})]})]}),(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsx)("h3",{className:"text-lg font-medium",children:"Additional Information"}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{htmlFor:"firstNameArabic",className:"block text-sm font-medium text-gray-700",children:"First Name (Arabic)"}),(0,s.jsx)("input",{type:"text",id:"firstNameArabic",name:"firstNameArabic",defaultValue:(null==a?void 0:a.firstNameArabic)||"",className:"mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500",dir:"rtl"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{htmlFor:"lastNameArabic",className:"block text-sm font-medium text-gray-700",children:"Last Name (Arabic)"}),(0,s.jsx)("input",{type:"text",id:"lastNameArabic",name:"lastNameArabic",defaultValue:(null==a?void 0:a.lastNameArabic)||"",className:"mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500",dir:"rtl"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{htmlFor:"languagePreference",className:"block text-sm font-medium text-gray-700",children:"Language Preference"}),(0,s.jsxs)("select",{id:"languagePreference",name:"languagePreference",defaultValue:(null==a?void 0:a.languagePreference)||"en",className:"mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500",children:[(0,s.jsx)("option",{value:"en",children:"English"}),(0,s.jsx)("option",{value:"ar",children:"Arabic"})]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{htmlFor:"isActive",className:"block text-sm font-medium text-gray-700",children:"Status"}),(0,s.jsxs)("select",{id:"isActive",name:"isActive",defaultValue:(null==a?void 0:a.isActive)===!1?"false":"true",className:"mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500",children:[(0,s.jsx)("option",{value:"true",children:"Active"}),(0,s.jsx)("option",{value:"false",children:"Inactive"})]})]})]})]}),(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsx)("h3",{className:"text-lg font-medium",children:"User Roles"}),x?(0,s.jsxs)("div",{className:"flex gap-3",children:[(0,s.jsx)("div",{className:"h-10 w-20 bg-gray-200 animate-pulse rounded-md"}),(0,s.jsx)("div",{className:"h-10 w-20 bg-gray-200 animate-pulse rounded-md"}),(0,s.jsx)("div",{className:"h-10 w-20 bg-gray-200 animate-pulse rounded-md"})]}):(0,s.jsx)("div",{className:"flex flex-wrap gap-3",children:b.map(e=>(0,s.jsx)("button",{type:"button",onClick:()=>y(e.name),className:"px-4 py-2 rounded-md ".concat(p.includes(e.name)?"bg-blue-600 text-white":"bg-gray-200 text-gray-700"),title:e.description||e.name,children:e.name},e.id))}),0===p.length&&(0,s.jsx)("p",{className:"text-sm text-red-500",children:"Please select at least one role"})]}),(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsx)("h3",{className:"text-lg font-medium",children:"Biography"}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{htmlFor:"bio",className:"block text-sm font-medium text-gray-700",children:"Bio (English)"}),(0,s.jsx)("textarea",{id:"bio",name:"bio",rows:4,defaultValue:(null==a?void 0:a.bio)||"",className:"mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{htmlFor:"bioArabic",className:"block text-sm font-medium text-gray-700",children:"Bio (Arabic)"}),(0,s.jsx)("textarea",{id:"bioArabic",name:"bioArabic",rows:4,defaultValue:(null==a?void 0:a.bioArabic)||"",className:"mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500",dir:"rtl"})]})]}),(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsx)("h3",{className:"text-lg font-medium",children:"Avatar"}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{htmlFor:"avatar",className:"block text-sm font-medium text-gray-700",children:"Avatar URL"}),(0,s.jsx)("input",{type:"text",id:"avatar",name:"avatar",defaultValue:(null==a?void 0:a.avatar)||"",className:"mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500"}),(null==a?void 0:a.avatar)&&(0,s.jsx)("div",{className:"mt-2",children:(0,s.jsx)("img",{src:a.avatar,alt:"User avatar",className:"w-20 h-20 rounded-full object-cover"})})]})]}),(0,s.jsxs)("div",{className:"flex justify-end gap-3",children:[(0,s.jsx)("button",{type:"button",onClick:()=>d.back(),className:"px-4 py-2 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50",children:"Cancel"}),(0,s.jsx)("button",{type:"submit",disabled:i||0===p.length,className:"px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 disabled:opacity-50",children:i?"Saving...":n})]})]})}},5202:(e,r,a)=>{a.d(r,{AuthProvider:()=>i,A:()=>d});var s=a(5155),l=a(2115),t=a(5828);let o=(0,t.createServerReference)("00d4248e5cc13d9a24c27da7f63c4e748a633f8d0d",t.callServer,void 0,t.findSourceMapURL,"logout"),n=(0,l.createContext)(void 0);function d(){let e=(0,l.useContext)(n);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}function i(e){let{children:r}=e,[a,t]=(0,l.useState)(null),[d,i]=(0,l.useState)(!0),[c,u]=(0,l.useState)(null),m=(0,l.useCallback)(async()=>{try{u(null);let e=await fetch("/api/auth/me",{credentials:"include",cache:"no-store"});if(e.ok)return await e.json();if(401===e.status)return null;throw Error("Failed to fetch user data")}catch(e){return console.error("Failed to load user:",e),u(e instanceof Error?e.message:"Failed to load user"),null}},[]),b=(0,l.useCallback)(async()=>{t(await m())},[m]);(0,l.useEffect)(()=>{let e=!0;return(async()=>{let r=await m();e&&(t(r),i(!1))})(),()=>{e=!1}},[m]);let f=(0,l.useCallback)(e=>!!a&&(!!(a.roles.includes("ADMIN")||a.roles.includes("SUPER_ADMIN"))||a.permissions.includes(e)),[a]),x=(0,l.useCallback)(e=>e.some(e=>f(e)),[f]),h=(0,l.useCallback)(e=>e.every(e=>f(e)),[f]),p=(0,l.useCallback)(async()=>{try{u(null),await o(),t(null),window.location.href="/admin/login"}catch(e){console.error("Logout failed:",e),u(e instanceof Error?e.message:"Logout failed")}},[]),g=l.useMemo(()=>({user:a,loading:d,error:c,setUser:t,hasPermission:f,hasAnyPermissions:x,hasAllPermissions:h,logout:p,refreshUser:b}),[a,d,c,f,x,h,p,b]);return(0,s.jsx)(n.Provider,{value:g,children:r})}}}]);