"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9154],{57:(e,t,a)=>{a.d(t,{default:()=>n});var s=a(5155),r=a(2115),l=a(8173),o=a.n(l),i=a(8277);function n(e){let{title:t,description:a,buttonText:l,buttonHref:n,buttonPermission:d,buttonAction:c,actions:u}=e,m=l&&(n||c),h=e=>{let t="ml-3 inline-flex items-center px-4 py-2 border rounded-md shadow-sm text-sm font-medium focus:outline-none focus:ring-2 focus:ring-offset-2";switch(e){case"secondary":return"".concat(t," border-gray-300 bg-white text-gray-700 hover:bg-gray-50 focus:ring-indigo-500");case"danger":return"".concat(t," border-transparent bg-red-600 text-white hover:bg-red-700 focus:ring-red-500");default:return"".concat(t," border-transparent bg-indigo-600 text-white hover:bg-indigo-700 focus:ring-indigo-500")}},g=(0,s.jsx)("button",{onClick:c,className:h(),children:l}),x=(0,s.jsx)(o(),{href:n||"#",className:h(),children:l});return(0,s.jsxs)("div",{className:"md:flex md:items-center md:justify-between",children:[(0,s.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,s.jsx)("h2",{className:"text-2xl font-bold leading-7 text-gray-900 sm:text-3xl sm:truncate",children:t}),a&&(0,s.jsx)("p",{className:"mt-1 text-sm text-gray-500",children:a})]}),(0,s.jsxs)("div",{className:"mt-4 flex md:mt-0 md:ml-4",children:[m&&d?(0,s.jsx)(i.A,{permissions:d,children:n?x:g}):m&&(n?x:g),u&&u.map((e,t)=>{let a=(0,s.jsx)(r.Fragment,{children:e.href?(0,s.jsxs)(o(),{href:e.href,className:h(e.variant),children:[e.icon&&(0,s.jsx)("span",{className:"mr-2",children:e.icon}),e.label]}):(0,s.jsxs)("button",{onClick:e.onClick,className:h(e.variant),children:[e.icon&&(0,s.jsx)("span",{className:"mr-2",children:e.icon}),e.label]})},t);return e.permission?(0,s.jsx)(i.A,{permissions:e.permission,children:a},t):a})]})]})}},106:(e,t,a)=>{a.d(t,{default:()=>f});var s=a(5155),r=a(2115),l=a(6046),o=a(1094),i=a(5202),n=a(7711),d=a(5565);function c(e){let{isOpen:t,onClose:a,onSelect:l,selectedId:o}=e,[i,n]=(0,r.useState)([]),[c,u]=(0,r.useState)(!0),[m,h]=(0,r.useState)(null),[g,x]=(0,r.useState)(""),[f,b]=(0,r.useState)("date"),[p,v]=(0,r.useState)("grid");(0,r.useEffect)(()=>{t&&y()},[t]);let y=async()=>{try{u(!0);let e=await fetch("/api/media");if(!e.ok)throw Error("Failed to fetch media items");let t=await e.json();n(t)}catch(e){h("Error loading media items"),console.error("Error fetching media:",e)}finally{u(!1)}},j=i.filter(e=>{var t,a;return(null===(t=e.title)||void 0===t?void 0:t.toLowerCase().includes(g.toLowerCase()))||(null===(a=e.altText)||void 0===a?void 0:a.toLowerCase().includes(g.toLowerCase()))}).sort((e,t)=>"date"===f?new Date(t.createdAt).getTime()-new Date(e.createdAt).getTime():(e.title||"").localeCompare(t.title||""));return t?(0,s.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:(0,s.jsxs)("div",{className:"bg-white rounded-lg w-full max-w-6xl h-[90vh] flex flex-col",children:[(0,s.jsxs)("div",{className:"p-4 border-b flex justify-between items-center",children:[(0,s.jsx)("h2",{className:"text-xl font-bold",children:"Media Gallery"}),(0,s.jsx)("button",{onClick:a,className:"text-gray-500 hover:text-gray-700",children:(0,s.jsx)("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),(0,s.jsxs)("div",{className:"p-4 border-b flex flex-wrap gap-4 items-center",children:[(0,s.jsx)("div",{className:"flex-1 min-w-[200px]",children:(0,s.jsx)("input",{type:"text",placeholder:"Search media...",value:g,onChange:e=>x(e.target.value),className:"w-full px-4 py-2 border rounded-md focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500"})}),(0,s.jsxs)("div",{className:"flex gap-2",children:[(0,s.jsxs)("select",{value:f,onChange:e=>b(e.target.value),className:"px-4 py-2 border rounded-md focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500",children:[(0,s.jsx)("option",{value:"date",children:"Sort by Date"}),(0,s.jsx)("option",{value:"name",children:"Sort by Name"})]}),(0,s.jsxs)("div",{className:"flex border rounded-md overflow-hidden",children:[(0,s.jsx)("button",{onClick:()=>v("grid"),className:"px-4 py-2 ".concat("grid"===p?"bg-indigo-500 text-white":"bg-white"),children:(0,s.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2V6zM14 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2V6zM4 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2v-2zM14 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2v-2z"})})}),(0,s.jsx)("button",{onClick:()=>v("list"),className:"px-4 py-2 ".concat("list"===p?"bg-indigo-500 text-white":"bg-white"),children:(0,s.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 6h16M4 12h16M4 18h16"})})})]})]})]}),(0,s.jsx)("div",{className:"flex-1 overflow-auto p-4",children:c?(0,s.jsx)("div",{className:"flex items-center justify-center h-full",children:(0,s.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-indigo-500"})}):m?(0,s.jsx)("div",{className:"flex items-center justify-center h-full text-red-500",children:m}):0===j.length?(0,s.jsx)("div",{className:"flex items-center justify-center h-full text-gray-500",children:"No media items found"}):"grid"===p?(0,s.jsx)("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4",children:j.map(e=>(0,s.jsxs)("div",{className:"relative aspect-square cursor-pointer group rounded-lg overflow-hidden border-2 ".concat(o===e.id?"border-indigo-500":"border-transparent"),onClick:()=>l(e),children:[(0,s.jsx)(d.default,{src:e.url,alt:e.altText||"Gallery image",fill:!0,className:"object-cover"}),(0,s.jsx)("div",{className:"absolute inset-0 bg-black bg-opacity-0 group-hover:bg-opacity-50 transition-opacity flex items-center justify-center",children:(0,s.jsx)("span",{className:"text-white opacity-0 group-hover:opacity-100",children:"Select"})}),(0,s.jsx)("div",{className:"absolute bottom-0 left-0 right-0 bg-black bg-opacity-50 text-white p-2 text-sm truncate",children:e.title||"Untitled"})]},e.id))}):(0,s.jsx)("div",{className:"space-y-2",children:j.map(e=>(0,s.jsxs)("div",{className:"flex items-center p-4 border rounded-lg cursor-pointer hover:bg-gray-50 ".concat(o===e.id?"border-indigo-500 bg-indigo-50":""),onClick:()=>l(e),children:[(0,s.jsx)("div",{className:"relative w-16 h-16 mr-4",children:(0,s.jsx)(d.default,{src:e.url,alt:e.altText||"Gallery image",fill:!0,className:"object-cover rounded"})}),(0,s.jsxs)("div",{className:"flex-1",children:[(0,s.jsx)("h3",{className:"font-medium",children:e.title||"Untitled"}),(0,s.jsx)("p",{className:"text-sm text-gray-500",children:new Date(e.createdAt).toLocaleDateString()})]})]},e.id))})})]})}):null}function u(e){let{value:t,onChange:a,authorId:r,isEdit:l=!1}=e,{user:n}=(0,i.A)();if(!n)return null;let d=r===n.id,c=e=>{switch(e){case o.PostStatus.DRAFT:return"Draft";case o.PostStatus.WAITING_APPROVAL:return"Waiting Approval";case o.PostStatus.READY_TO_PUBLISH:return"Ready to Publish";case o.PostStatus.PUBLISHED:return"Published";case o.PostStatus.UNPUBLISHED:return"Unpublished";case o.PostStatus.ARCHIVED:return"Archived";case o.PostStatus.DECLINED:return"Declined";default:return"Unknown"}},u=(()=>{let e=n.roles||[];return e.includes("SUPER_ADMIN")||e.includes("EDITOR_IN_CHIEF")||e.includes("EDITORIAL")?[{value:o.PostStatus.DRAFT,label:"Draft"},{value:o.PostStatus.WAITING_APPROVAL,label:"Waiting Approval"},{value:o.PostStatus.READY_TO_PUBLISH,label:"Ready to Publish"},{value:o.PostStatus.PUBLISHED,label:"Published"},{value:o.PostStatus.DECLINED,label:"Declined"},{value:o.PostStatus.UNPUBLISHED,label:"Unpublished"},{value:o.PostStatus.ARCHIVED,label:"Archived"}]:e.includes("SENIOR_EDITOR")?[{value:o.PostStatus.DRAFT,label:"Draft"},{value:o.PostStatus.WAITING_APPROVAL,label:"Waiting Approval"},{value:o.PostStatus.READY_TO_PUBLISH,label:"Ready to Publish"}]:e.includes("EDITOR")&&(!l||d)?[{value:o.PostStatus.DRAFT,label:"Draft"},{value:o.PostStatus.WAITING_APPROVAL,label:"Waiting Approval"}]:[{value:t,label:c(t)}]})();return(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{htmlFor:"status",className:"block text-sm font-medium text-gray-700",children:"Status"}),(0,s.jsx)("select",{id:"status",name:"status",value:t,onChange:a,className:"mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm rounded-md",children:u.map(e=>(0,s.jsx)("option",{value:e.value,children:e.label},e.value))})]})}var m=a(6441),h=a(2471),g=a(7721);let x=(0,n.default)(()=>Promise.all([a.e(5797),a.e(1181),a.e(6351)]).then(a.bind(a,6351)),{loadableGenerated:{webpack:()=>[6351]},ssr:!1,loading:()=>(0,s.jsx)("div",{className:"h-64 w-full bg-gray-100 animate-pulse rounded-md"})});function f(e){let{post:t,isEdit:a=!1}=e,n=(0,l.useRouter)(),d=(0,l.useSearchParams)().get("category"),{user:f}=(0,i.A)(),[b,p]=(0,r.useState)({status:o.PostStatus.DRAFT,categoryId:"",authorId:(null==f?void 0:f.id)||"",postAuthorId:"",featured:!1,metaData:{},tags:[],translations:[{locale:"en",title:"",content:"",summary:"",slug:"",dir:"ltr"},{locale:"ar",title:"",content:"",summary:"",slug:"",dir:"rtl"}]}),[v,y]=(0,r.useState)([]),[j,w]=(0,r.useState)([]),[N,k]=(0,r.useState)([]),[C,S]=(0,r.useState)(null),[A,E]=(0,r.useState)(""),[I,P]=(0,r.useState)(!1),[L,D]=(0,r.useState)([]),[F,T]=(0,r.useState)(!1),[M,R]=(0,r.useState)(null),[U,O]=(0,r.useState)("en"),[_,B]=(0,r.useState)({name:"",nameArabic:""}),[H,W]=(0,r.useState)([{key:"seo_title",value:""},{key:"seo_description",value:""},{key:"seo_keywords",value:""}]),[z,G]=(0,r.useState)([]),[q,V]=(0,r.useState)([]),[J,Y]=(0,r.useState)(!1),[K,Q]=(0,r.useState)(!1),[X,Z]=(0,r.useState)(null),[$,ee]=(0,r.useState)({basicInfo:!0,content:!0,media:!0,metadata:!1}),et=e=>{ee(t=>({...t,[e]:!t[e]}))};(0,r.useEffect)(()=>{(async()=>{try{let e=await fetch("/api/admin/categories?flat=true");if(!e.ok)throw Error("Failed to fetch categories");let t=await e.json();y(t);let a=await fetch("/api/admin/tags");if(!a.ok)throw Error("Failed to fetch tags");let s=await a.json();w(s);let r=await fetch("/api/authors");if(!r.ok)throw Error("Failed to fetch authors");let l=await r.json();k(l),D(l)}catch(e){console.error("Error fetching data:",e),R("Failed to load necessary data. Please try again.")}})()},[]),(0,r.useEffect)(()=>{""===A.trim()?D(N):D(N.filter(e=>e.nameEn.toLowerCase().includes(A.toLowerCase())||e.nameAr&&e.nameAr.includes(A)||e.country&&e.country.toLowerCase().includes(A.toLowerCase())))},[A,N]),(0,r.useEffect)(()=>{let e=e=>{e.target.closest(".author-dropdown-container")||P(!1)};return I&&document.addEventListener("mousedown",e),()=>{document.removeEventListener("mousedown",e)}},[I]),(0,r.useEffect)(()=>{if(t&&a){var e;let a=(null===(e=t.tags)||void 0===e?void 0:e.map(e=>e.tag.id))||[],s={};t.metaData&&"object"==typeof t.metaData&&(s=t.metaData);let r=Object.entries(s).map(e=>{let[t,a]=e;return{key:t,value:(null==a?void 0:a.toString())||""}});if(r.length>0&&W(r),t.media&&t.media.length>0&&V(t.media),t.postAuthor){let e=t.postAuthor;S(e),E(e.nameEn)}p({status:t.status,statusReason:t.statusReason||"",categoryId:t.categoryId,authorId:t.authorId,postAuthorId:t.postAuthorId||"",featured:t.featured,metaData:s,tags:a,translations:t.translations})}else d&&!b.categoryId&&p(e=>({...e,categoryId:d}))},[t,a,d,b.categoryId]);let ea=e=>{S(e),E(e.nameEn),P(!1),p(t=>({...t,postAuthorId:e.id}))},es=(e,t,a)=>{p(s=>{let r=s.translations.map(s=>s.locale===e?{...s,[t]:a}:s);return{...s,translations:r}})},er=e=>{let t=b.translations.find(t=>t.locale===e);t&&t.title&&es(e,"slug",t.title.toLowerCase().replace(/[^\w\s]/gi,"").replace(/\s+/g,"-"))},el=(e,t,a)=>{let s=[...H];s[e][t]=a,W(s)},eo=e=>{let t=[...H];t.splice(e,1),W(t)},ei=(e,t)=>{B(a=>({...a,[e]:t}))},en=async()=>{if(!_.name){alert("Tag name is required");return}try{let e=await fetch("/api/admin/tags",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(_)});if(!e.ok)throw Error("Failed to create tag");let t=await e.json();w([...j,t]),p(e=>({...e,tags:[...e.tags,t.id]})),B({name:"",nameArabic:""})}catch(e){console.error("Error creating tag:",e),alert("Failed to create tag. Please try again.")}},ed=async e=>{if(e.preventDefault(),!F){R(null),T(!0);try{if(!b.categoryId)throw Error("Please select a category");if(!b.postAuthorId)throw Error("Please select an author");if(b.translations.some(e=>"en"===e.locale&&!e.title))throw Error("English title is required");if(b.translations.some(e=>"en"===e.locale&&!e.content))throw Error("English content is required");let e={};H.forEach(t=>{t.key&&t.value&&(e[t.key]=t.value)});let s=q.map(e=>e.id),r={...b,authorId:b.authorId||(null==f?void 0:f.id),metaData:e,mediaIds:s},l=a&&t?"/api/admin/posts/".concat(t.id):"/api/admin/posts",o=a?"PUT":"POST",i=await fetch(l,{method:o,headers:{"Content-Type":"application/json"},body:JSON.stringify(r)});if(!i.ok){let e=await i.json();throw Error(e.error||"Failed to save post")}let d=await i.json();a?t?n.push("/admin/posts/".concat(t.id,"/edit?success=updated")):n.push("/admin/content?success=updated"):n.push("/admin/posts/".concat(d.id,"/edit?success=created"))}catch(e){console.error("Error saving post:",e),R(e.message||"Failed to save post"),T(!1)}}};b.translations.find(e=>e.locale===U);let ec=e=>{G(t=>t.filter((t,a)=>a!==e))},eu=async()=>{if(0!==z.length){Y(!0),R(null);try{let e=new FormData;z.forEach(t=>{e.append("files",t)}),a&&(null==t?void 0:t.id)&&(e.append("postId",t.id),console.log("Adding images to post: ".concat(t.id)));let s=await fetch("/api/admin/media/upload",{method:"POST",body:e});if(!s.ok)throw Error("Failed to upload media");let r=await s.json();if(V(e=>[...e,...r]),G([]),r.length>0){let e=document.createElement("div");e.className="bg-green-50 border-l-4 border-green-400 p-4 mb-4",e.innerHTML='\n          <div class="flex">\n            <div class="flex-shrink-0">\n              <svg class="h-5 w-5 text-green-400" viewBox="0 0 20 20" fill="currentColor">\n                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd" />\n              </svg>\n            </div>\n            <div class="ml-3">\n              <p class="text-sm text-green-700">Media uploaded successfully</p>\n            </div>\n          </div>\n        ';let t=document.querySelector("form");t&&(t.prepend(e),setTimeout(()=>{e.remove()},3e3))}}catch(e){console.error("Error uploading media:",e),R("Failed to upload media. Please try again.")}finally{Y(!1)}}},em=async e=>{if(V(t=>t.filter(t=>t.id!==e)),(null==X?void 0:X.id)===e&&Z(null),a&&(null==t?void 0:t.id))try{(await fetch("/api/admin/posts/".concat(t.id,"/media/").concat(e),{method:"DELETE"})).ok||console.error("Failed to remove media from post")}catch(e){console.error("Error removing media from post:",e)}};return(0,s.jsxs)("form",{onSubmit:ed,className:"space-y-6",children:[M&&(0,s.jsx)("div",{className:"bg-red-50 border-l-4 border-red-400 p-4 mb-4 rounded-md",children:(0,s.jsxs)("div",{className:"flex",children:[(0,s.jsx)("div",{className:"flex-shrink-0",children:(0,s.jsx)("svg",{className:"h-5 w-5 text-red-400",viewBox:"0 0 20 20",fill:"currentColor",children:(0,s.jsx)("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z",clipRule:"evenodd"})})}),(0,s.jsx)("div",{className:"ml-3",children:(0,s.jsx)("p",{className:"text-sm text-red-700",children:M})})]})}),(0,s.jsxs)("div",{className:"bg-white p-4 rounded-md shadow border border-gray-200",children:[(0,s.jsxs)("button",{type:"button",className:"flex justify-between items-center w-full text-left px-2 py-3",onClick:()=>et("basicInfo"),children:[(0,s.jsx)("h3",{className:"text-lg font-medium text-gray-900",children:"Basic Information"}),$.basicInfo?(0,s.jsx)(m.A,{className:"h-5 w-5 text-gray-500"}):(0,s.jsx)(h.A,{className:"h-5 w-5 text-gray-500"})]}),$.basicInfo&&(0,s.jsxs)("div",{className:"mt-4 space-y-6 border-t border-gray-200 pt-4",children:[(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,s.jsxs)("div",{className:"mb-4",children:[(0,s.jsx)("label",{htmlFor:"category",className:"block text-sm font-medium text-gray-700 mb-1",children:"Category *"}),(0,s.jsxs)("select",{id:"category",value:b.categoryId,onChange:e=>{p(t=>({...t,categoryId:e.target.value}))},className:"block w-full px-3 py-2 text-gray-700 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 bg-white",required:!0,children:[(0,s.jsx)("option",{value:"",children:"Select a category"}),v.map(e=>{var t;return(0,s.jsx)("option",{value:e.id,children:(null===(t=e.translations[0])||void 0===t?void 0:t.name)||"Unnamed Category"},e.id)})]})]}),(0,s.jsx)("div",{className:"mb-4",children:(0,s.jsx)(u,{value:b.status,onChange:e=>{p(t=>({...t,status:e.target.value}))},authorId:b.authorId,isEdit:a})})]}),(0,s.jsxs)("div",{className:"mb-4 border border-gray-200 rounded-lg p-4 bg-gray-50",children:[(0,s.jsx)("h4",{className:"text-sm font-medium text-gray-700 mb-3",children:"Author Selection"}),(0,s.jsxs)("div",{className:"relative author-dropdown-container",children:[(0,s.jsx)("label",{htmlFor:"authorSearch",className:"block text-sm font-medium text-gray-700 mb-1",children:"Select Author *"}),(0,s.jsxs)("div",{className:"relative",children:[(0,s.jsx)("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:(0,s.jsx)(g.A,{className:"h-5 w-5 text-gray-400"})}),(0,s.jsx)("input",{type:"text",id:"authorSearch",value:A,onChange:e=>{E(e.target.value),P(!0)},onFocus:()=>P(!0),className:"block w-full pl-10 px-3 py-2 text-gray-700 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 bg-white",placeholder:"Search authors by name or country...",required:!0})]}),I&&(0,s.jsx)("div",{className:"absolute z-10 w-full mt-1 bg-white border border-gray-300 rounded-md shadow-lg max-h-60 overflow-y-auto",children:L.length>0?L.map(e=>(0,s.jsx)("div",{className:"px-4 py-3 hover:bg-gray-50 cursor-pointer border-b border-gray-100 last:border-b-0",onClick:()=>ea(e),children:(0,s.jsxs)("div",{className:"flex justify-between items-start",children:[(0,s.jsxs)("div",{className:"flex-1",children:[(0,s.jsx)("div",{className:"font-medium text-gray-900",children:e.nameEn}),e.nameAr&&(0,s.jsx)("div",{className:"text-sm text-gray-600 mt-1",dir:"rtl",children:e.nameAr}),e.country&&(0,s.jsxs)("div",{className:"text-xs text-gray-500 mt-1",children:["\uD83D\uDCCD ",e.country]})]}),e.avatar&&(0,s.jsx)("img",{src:e.avatar,alt:e.nameEn,className:"w-8 h-8 rounded-full ml-3"})]})},e.id)):(0,s.jsx)("div",{className:"px-4 py-3 text-gray-500 text-sm",children:"No authors found matching your search."})}),C&&(0,s.jsx)("div",{className:"mt-2 p-3 bg-white border border-gray-200 rounded-md",children:(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)("div",{className:"flex items-center space-x-3",children:[C.avatar&&(0,s.jsx)("img",{src:C.avatar,alt:C.nameEn,className:"w-10 h-10 rounded-full"}),(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{className:"font-medium text-gray-900",children:C.nameEn}),C.nameAr&&(0,s.jsx)("div",{className:"text-sm text-gray-600",dir:"rtl",children:C.nameAr}),C.country&&(0,s.jsxs)("div",{className:"text-xs text-gray-500",children:["\uD83D\uDCCD ",C.country]})]})]}),(0,s.jsx)("button",{type:"button",onClick:()=>{S(null),E(""),p(e=>({...e,postAuthorId:""}))},className:"text-red-600 hover:text-red-800 text-sm",children:"Remove"})]})})]})]}),(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{htmlFor:"tags",className:"block text-sm font-medium text-gray-700 mb-1",children:"Tags"}),(0,s.jsx)("select",{id:"tags",name:"tags",multiple:!0,value:b.tags,onChange:e=>{let t=Array.from(e.target.selectedOptions,e=>e.value);p(e=>({...e,tags:t}))},className:"block w-full px-3 py-2 text-gray-700 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 bg-white min-h-[100px]",children:j.map(e=>(0,s.jsx)("option",{value:e.id,children:e.name},e.id))}),(0,s.jsx)("p",{className:"mt-1 text-xs text-gray-500",children:"Hold Ctrl/Cmd to select multiple tags"})]}),(0,s.jsxs)("div",{children:[(0,s.jsxs)("div",{className:"flex items-center justify-between mb-1",children:[(0,s.jsx)("label",{htmlFor:"new-tag",className:"block text-sm font-medium text-gray-700",children:"Create New Tag"}),(0,s.jsx)("button",{type:"button",onClick:en,className:"inline-flex items-center px-3 py-1.5 border border-transparent text-sm font-medium rounded-md text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500",children:"Add"})]}),(0,s.jsxs)("div",{className:"grid grid-cols-2 gap-2",children:[(0,s.jsx)("input",{id:"new-tag",type:"text",placeholder:"Tag name (English)",value:_.name,onChange:e=>ei("name",e.target.value),className:"block w-full px-3 py-2 text-gray-700 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 bg-white"}),(0,s.jsx)("input",{type:"text",placeholder:"Tag name (Arabic)",value:_.nameArabic,onChange:e=>ei("nameArabic",e.target.value),className:"block w-full px-3 py-2 text-gray-700 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 bg-white"})]})]})]}),(0,s.jsx)("div",{className:"mb-6",children:(0,s.jsxs)("div",{className:"flex items-center",children:[(0,s.jsx)("input",{type:"checkbox",id:"featured",checked:b.featured,onChange:e=>{p(t=>({...t,featured:e.target.checked}))},className:"h-5 w-5 text-indigo-600 border-gray-300 rounded focus:ring-indigo-500"}),(0,s.jsx)("label",{htmlFor:"featured",className:"ml-2 block text-sm text-gray-700",children:"Featured Post (will appear in featured sections)"})]})})]})]}),(0,s.jsxs)("div",{className:"bg-white p-4 rounded-md shadow border border-gray-200",children:[(0,s.jsxs)("button",{type:"button",className:"flex justify-between items-center w-full text-left px-2 py-3",onClick:()=>et("content"),children:[(0,s.jsx)("h3",{className:"text-lg font-medium text-gray-900",children:"Content"}),$.content?(0,s.jsx)(m.A,{className:"h-5 w-5 text-gray-500"}):(0,s.jsx)(h.A,{className:"h-5 w-5 text-gray-500"})]}),$.content&&(0,s.jsxs)("div",{className:"mt-4 space-y-6 border-t border-gray-200 pt-4",children:[(0,s.jsx)("div",{className:"border-b border-gray-200",children:(0,s.jsx)("div",{className:"flex",children:b.translations.map(e=>(0,s.jsx)("button",{type:"button",onClick:()=>O(e.locale),className:"".concat(U===e.locale?"border-indigo-500 text-indigo-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"," px-4 py-2 text-sm font-medium border-b-2"),children:"en"===e.locale?"English":"العربية"},e.locale))})}),b.translations.map(e=>(0,s.jsxs)("div",{className:"transition-opacity duration-200 ".concat(U===e.locale?"block":"hidden"),dir:e.dir,children:[(0,s.jsxs)("div",{className:"mb-4",children:[(0,s.jsxs)("label",{htmlFor:"title-".concat(e.locale),className:"block text-sm font-medium text-gray-700 mb-1",children:["Title ","en"===e.locale?"*":""]}),(0,s.jsx)("input",{type:"text",id:"title-".concat(e.locale),value:e.title,onChange:t=>es(e.locale,"title",t.target.value),className:"block w-full px-3 py-2 text-gray-700 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 bg-white",required:"en"===e.locale,dir:e.dir})]}),(0,s.jsxs)("div",{className:"mb-4",children:[(0,s.jsxs)("label",{htmlFor:"slug-".concat(e.locale),className:"block text-sm font-medium text-gray-700 mb-1",children:["Slug ","en"===e.locale?"*":""]}),(0,s.jsxs)("div",{className:"flex items-center",children:[(0,s.jsx)("input",{type:"text",id:"slug-".concat(e.locale),value:e.slug,onChange:t=>es(e.locale,"slug",t.target.value),className:"block w-full px-3 py-2 text-gray-700 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 bg-white",required:"en"===e.locale,dir:"ltr"}),(0,s.jsx)("button",{type:"button",onClick:()=>er(e.locale),className:"ml-2 px-3 py-1.5 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500",children:"Generate"})]})]}),(0,s.jsxs)("div",{className:"mb-4",children:[(0,s.jsx)("label",{htmlFor:"summary-".concat(e.locale),className:"block text-sm font-medium text-gray-700 mb-1",children:"Summary"}),(0,s.jsx)("textarea",{id:"summary-".concat(e.locale),value:e.summary,onChange:t=>es(e.locale,"summary",t.target.value),rows:3,className:"block w-full px-3 py-2 text-gray-700 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 bg-white",dir:e.dir})]}),(0,s.jsxs)("div",{className:"mb-4",children:[(0,s.jsxs)("label",{htmlFor:"content-".concat(e.locale),className:"block text-sm font-medium text-gray-700 mb-1",children:["Content ","en"===e.locale?"*":""]}),(0,s.jsx)(x,{value:e.content,onChange:t=>es(e.locale,"content",t),placeholder:"Write your post content here...",locale:e.locale})]})]},e.locale))]})]}),(0,s.jsxs)("div",{className:"bg-white p-4 rounded-md shadow border border-gray-200",children:[(0,s.jsxs)("button",{type:"button",className:"flex justify-between items-center w-full text-left px-2 py-3",onClick:()=>et("media"),children:[(0,s.jsx)("h3",{className:"text-lg font-medium text-gray-900",children:"Featured Image"}),$.media?(0,s.jsx)(m.A,{className:"h-5 w-5 text-gray-500"}):(0,s.jsx)(h.A,{className:"h-5 w-5 text-gray-500"})]}),$.media&&(0,s.jsxs)("div",{className:"mt-4 space-y-6 border-t border-gray-200 pt-4",children:[(0,s.jsx)("p",{className:"text-sm text-gray-500 mb-4",children:"Upload an image to represent this post. This image will be used in listings and social media shares."}),(q.length>0||X)&&(0,s.jsxs)("div",{className:"mb-4",children:[(0,s.jsx)("h4",{className:"text-sm font-medium mb-2",children:"Selected Media"}),(0,s.jsx)("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3",children:q.map(e=>(0,s.jsxs)("div",{className:"relative group",children:[(0,s.jsx)("div",{className:"aspect-video bg-gray-100 rounded-md overflow-hidden shadow-md hover:shadow-lg transition-all",children:(0,s.jsx)("img",{src:e.url,alt:e.altText||"Media item",className:"w-full h-full object-cover"})}),(0,s.jsx)("div",{className:"absolute inset-0 bg-black bg-opacity-0 group-hover:bg-opacity-30 transition-all flex items-center justify-center opacity-0 group-hover:opacity-100",children:(0,s.jsx)("button",{type:"button",className:"bg-red-600 text-white p-1 rounded-full hover:bg-red-700 transition-colors",onClick:()=>em(e.id),children:(0,s.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})}),(0,s.jsx)("div",{className:"absolute bottom-1 left-1 right-1 text-xs bg-black bg-opacity-50 text-white p-1 rounded truncate",children:e.title||"Untitled"})]},e.id))})]}),(0,s.jsxs)("div",{className:"mb-3",children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Select Image"}),(0,s.jsx)("div",{className:"mt-1 flex justify-center px-6 pt-5 pb-6 border-2 border-gray-300 border-dashed rounded-md hover:bg-gray-50 transition-colors cursor-pointer",children:(0,s.jsxs)("div",{className:"space-y-1 text-center",children:[(0,s.jsx)("svg",{className:"mx-auto h-12 w-12 text-gray-400",stroke:"currentColor",fill:"none",viewBox:"0 0 48 48","aria-hidden":"true",children:(0,s.jsx)("path",{d:"M28 8H12a4 4 0 00-4 4v20m32-12v8m0 0v8a4 4 0 01-4 4H12a4 4 0 01-4-4v-4m32-4l-3.172-3.172a4 4 0 00-5.656 0L28 28M8 32l9.172-9.172a4 4 0 015.656 0L28 28m0 0l4 4m4-24h8m-4-4v8m-12 4h.02",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"})}),(0,s.jsxs)("div",{className:"flex text-sm text-gray-600",children:[(0,s.jsxs)("label",{htmlFor:"file-upload",className:"relative cursor-pointer bg-white rounded-md font-medium text-indigo-600 hover:text-indigo-500 focus-within:outline-none focus-within:ring-2 focus-within:ring-offset-2 focus-within:ring-indigo-500",children:[(0,s.jsx)("span",{children:"Upload a file"}),(0,s.jsx)("input",{id:"file-upload",name:"file-upload",type:"file",className:"sr-only",accept:"image/*",onChange:e=>{if(e.target.files&&e.target.files.length>0){let t=Array.from(e.target.files);G(e=>[...e,...t])}}})]}),(0,s.jsx)("p",{className:"pl-1",children:"or drag and drop"}),(0,s.jsx)("button",{type:"button",onClick:()=>Q(!0),className:"pl-1 text-indigo-600 hover:text-indigo-500",children:"or choose from gallery"})]}),(0,s.jsx)("p",{className:"text-xs text-gray-500",children:"PNG, JPG, GIF up to 10MB"})]})})]}),z.length>0&&(0,s.jsxs)("div",{className:"mb-3",children:[(0,s.jsx)("h4",{className:"text-sm font-medium mb-2",children:"Files to Upload"}),(0,s.jsx)("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3",children:z.map((e,t)=>(0,s.jsxs)("div",{className:"relative group",children:[(0,s.jsx)("div",{className:"aspect-video bg-gray-100 rounded-md overflow-hidden shadow-md",children:(0,s.jsx)("img",{src:URL.createObjectURL(e),alt:e.name,className:"w-full h-full object-cover"})}),(0,s.jsx)("div",{className:"absolute inset-0 bg-black bg-opacity-0 group-hover:bg-opacity-30 transition-all flex items-center justify-center opacity-0 group-hover:opacity-100",children:(0,s.jsx)("button",{type:"button",className:"bg-red-600 text-white p-1 rounded-full hover:bg-red-700 transition-colors",onClick:()=>ec(t),children:(0,s.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})}),(0,s.jsx)("div",{className:"absolute bottom-1 left-1 right-1 text-xs bg-black bg-opacity-50 text-white p-1 rounded truncate",children:e.name})]},t))})]}),z.length>0&&(0,s.jsx)("button",{type:"button",onClick:eu,disabled:J,className:"mt-3 inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 disabled:bg-indigo-300 transition-colors",children:J?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("svg",{className:"animate-spin -ml-1 mr-2 h-4 w-4 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[(0,s.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),(0,s.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Uploading..."]}):"Upload Images"})]})]}),(0,s.jsxs)("div",{className:"bg-white p-4 rounded-md shadow border border-gray-200",children:[(0,s.jsxs)("button",{type:"button",className:"flex justify-between items-center w-full text-left px-2 py-3",onClick:()=>et("metadata"),children:[(0,s.jsx)("h3",{className:"text-lg font-medium text-gray-900",children:"SEO & Metadata"}),$.metadata?(0,s.jsx)(m.A,{className:"h-5 w-5 text-gray-500"}):(0,s.jsx)(h.A,{className:"h-5 w-5 text-gray-500"})]}),$.metadata&&(0,s.jsx)("div",{className:"mt-4 space-y-6 border-t border-gray-200 pt-4",children:(0,s.jsxs)("div",{className:"space-y-3",children:[H.map((e,t)=>(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-6 gap-3 items-center",children:[(0,s.jsx)("div",{className:"md:col-span-2",children:(0,s.jsx)("input",{type:"text",value:e.key,onChange:e=>el(t,"key",e.target.value),placeholder:"Meta key",className:"block w-full px-3 py-2 text-gray-700 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 bg-white"})}),(0,s.jsx)("div",{className:"md:col-span-3",children:(0,s.jsx)("input",{type:"text",value:e.value,onChange:e=>el(t,"value",e.target.value),placeholder:"Meta value",className:"block w-full px-3 py-2 text-gray-700 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 bg-white"})}),(0,s.jsx)("div",{className:"md:col-span-1 flex justify-end",children:(0,s.jsx)("button",{type:"button",onClick:()=>eo(t),className:"inline-flex items-center p-1.5 border border-gray-300 rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500",children:(0,s.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})})]},t)),(0,s.jsx)("button",{type:"button",onClick:()=>{W([...H,{key:"",value:""}])},className:"mt-2 inline-flex items-center px-3 py-1.5 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500",children:"Add Metadata Field"})]})})]}),(0,s.jsx)("div",{className:"flex justify-end",children:(0,s.jsx)("button",{type:"submit",disabled:F,className:"inline-flex items-center px-4 py-2 border border-transparent rounded-md shadow-sm text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 disabled:opacity-50",children:F?"Saving...":a?"Update Post":"Create Post"})}),(0,s.jsx)(c,{isOpen:K,onClose:()=>Q(!1),onSelect:e=>{Z(e),Q(!1),q.some(t=>t.id===e.id)||V(t=>[...t,e])},selectedId:null==X?void 0:X.id})]})}},8277:(e,t,a)=>{a.d(t,{A:()=>l});var s=a(5155);a(2115);var r=a(5202);function l(e){let{permissions:t,type:a="any",fallback:l=null,children:o}=e,{hasPermission:i,hasAllPermissions:n,hasAnyPermissions:d,loading:c}=(0,r.A)(),u=Array.isArray(t)?t:[t];return c?null:("all"===a?n(u):d(u))?(0,s.jsx)(s.Fragment,{children:o}):(0,s.jsx)(s.Fragment,{children:l})}},5202:(e,t,a)=>{a.d(t,{AuthProvider:()=>d,A:()=>n});var s=a(5155),r=a(2115),l=a(5828);let o=(0,l.createServerReference)("00d4248e5cc13d9a24c27da7f63c4e748a633f8d0d",l.callServer,void 0,l.findSourceMapURL,"logout"),i=(0,r.createContext)(void 0);function n(){let e=(0,r.useContext)(i);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}function d(e){let{children:t}=e,[a,l]=(0,r.useState)(null),[n,d]=(0,r.useState)(!0),[c,u]=(0,r.useState)(null),m=(0,r.useCallback)(async()=>{try{u(null);let e=await fetch("/api/auth/me",{credentials:"include",cache:"no-store"});if(e.ok)return await e.json();if(401===e.status)return null;throw Error("Failed to fetch user data")}catch(e){return console.error("Failed to load user:",e),u(e instanceof Error?e.message:"Failed to load user"),null}},[]),h=(0,r.useCallback)(async()=>{l(await m())},[m]);(0,r.useEffect)(()=>{let e=!0;return(async()=>{let t=await m();e&&(l(t),d(!1))})(),()=>{e=!1}},[m]);let g=(0,r.useCallback)(e=>!!a&&(!!(a.roles.includes("ADMIN")||a.roles.includes("SUPER_ADMIN"))||a.permissions.includes(e)),[a]),x=(0,r.useCallback)(e=>e.some(e=>g(e)),[g]),f=(0,r.useCallback)(e=>e.every(e=>g(e)),[g]),b=(0,r.useCallback)(async()=>{try{u(null),await o(),l(null),window.location.href="/admin/login"}catch(e){console.error("Logout failed:",e),u(e instanceof Error?e.message:"Logout failed")}},[]),p=r.useMemo(()=>({user:a,loading:n,error:c,setUser:l,hasPermission:g,hasAnyPermissions:x,hasAllPermissions:f,logout:b,refreshUser:h}),[a,n,c,g,x,f,b,h]);return(0,s.jsx)(i.Provider,{value:p,children:t})}}}]);