"use strict";(()=>{var e={};e.id=7795,e.ids=[7795],e.modules={96330:e=>{e.exports=require("@prisma/client")},10846:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},44870:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},3295:e=>{e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},29294:e=>{e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},63033:e=>{e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},55511:e=>{e.exports=require("crypto")},4573:e=>{e.exports=require("node:buffer")},77598:e=>{e.exports=require("node:crypto")},57975:e=>{e.exports=require("node:util")},66685:(e,t,r)=>{r.r(t),r.d(t,{patchFetch:()=>E,routeModule:()=>x,serverHooks:()=>I,workAsyncStorage:()=>h,workUnitAsyncStorage:()=>f});var s={};r.r(s),r.d(s,{DELETE:()=>R,GET:()=>c,PUT:()=>m});var o=r(42706),n=r(28203),a=r(45994),i=r(39187),u=r(65220),d=r(60399);let p=new u.K,l=new d.u;async function c(e,{params:t}){try{if(!await l.hasPermission(e,"view_content"))return i.NextResponse.json({error:"Unauthorized"},{status:403});let r=await l.getUserFromRequest(e);if(!r)return i.NextResponse.json({error:"Unauthorized - User not found"},{status:401});let{searchParams:s}=new URL(e.url),o=s.get("locale"),n=await p.getById(t.id,o||void 0);if(!n)return i.NextResponse.json({error:"Post not found"},{status:404});let a=r.roles||[];return a.some(e=>e.role?.name==="SUPER_ADMIN"||e.role?.name==="EDITOR_IN_CHIEF"||e.role?.name==="EDITORIAL"),a.some(e=>e.role?.name==="SENIOR_EDITOR"),a.some(e=>e.role?.name==="EDITOR"),n.authorId,r.id,i.NextResponse.json(n)}catch(e){return console.error("Error fetching post:",e),i.NextResponse.json({error:"Failed to fetch post"},{status:500})}}async function m(e,{params:t}){try{if(!await l.hasPermission(e,"update_content"))return i.NextResponse.json({error:"Unauthorized"},{status:403});let r=await l.getUserFromRequest(e);if(!r)return i.NextResponse.json({error:"Unauthorized - User not found"},{status:401});let s=await p.getById(t.id);if(!s)return i.NextResponse.json({error:"Post not found"},{status:404});let o=await e.json(),n=r.roles||[],a=n.some(e=>e.role?.name==="SUPER_ADMIN"||e.role?.name==="EDITOR_IN_CHIEF"||e.role?.name==="EDITORIAL"),u=n.some(e=>e.role?.name==="SENIOR_EDITOR"),d=n.some(e=>e.role?.name==="EDITOR"),c=s.authorId===r.id;if(d&&!a&&!u&&!c)return i.NextResponse.json({error:"As an Editor, you can only edit your own posts"},{status:403});if(o.status){if("PUBLISHED"===o.status||"DECLINED"===o.status){if(!a)return i.NextResponse.json({error:"You do not have permission to publish or decline content"},{status:403});"PUBLISHED"===o.status?(o.publishedById=r.id,o.publishedAt=new Date):"DECLINED"===o.status&&(o.declinedById=r.id)}else if("READY_TO_PUBLISH"===o.status){if(!a&&!u)return i.NextResponse.json({error:"You do not have permission to mark content as ready to publish"},{status:403});o.approvedById=r.id}else if(d&&!a&&!u&&"DRAFT"!==o.status&&"WAITING_APPROVAL"!==o.status)return i.NextResponse.json({error:"As an Editor, you can only set status to Draft or Waiting Approval"},{status:403});o.statusUpdatedAt=new Date}o.updatedById=r.id,""===o.authorName&&(o.authorName=null),""===o.authorNameArabic&&(o.authorNameArabic=null);let m=await p.update(t.id,o);return i.NextResponse.json(m)}catch(e){return console.error("Error updating post:",e),i.NextResponse.json({error:e.message||"Failed to update post"},{status:400})}}async function R(e,{params:t}){try{if(!await l.hasPermission(e,"delete_content"))return i.NextResponse.json({error:"Unauthorized"},{status:403});let{searchParams:r}=new URL(e.url);if("true"===r.get("hard")){if(!await l.hasPermission(e,"hard_delete_content"))return i.NextResponse.json({error:"You do not have permission to permanently delete content"},{status:403});await p.hardDelete(t.id)}else await p.softDelete(t.id);return i.NextResponse.json({success:!0})}catch(e){return console.error("Error deleting post:",e),i.NextResponse.json({error:e.message||"Failed to delete post"},{status:400})}}let x=new o.AppRouteRouteModule({definition:{kind:n.RouteKind.APP_ROUTE,page:"/api/admin/posts/[id]/route",pathname:"/api/admin/posts/[id]",filename:"route",bundlePath:"app/api/admin/posts/[id]/route"},resolvedPagePath:"D:\\press\\src\\app\\api\\admin\\posts\\[id]\\route.ts",nextConfigOutput:"standalone",userland:s}),{workAsyncStorage:h,workUnitAsyncStorage:f,serverHooks:I}=x;function E(){return(0,a.patchFetch)({workAsyncStorage:h,workUnitAsyncStorage:f})}}};var t=require("../../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[638,5452,4512,4926,7031,5371,5220],()=>r(66685));module.exports=s})();