(()=>{var e={};e.id=6202,e.ids=[6202],e.modules={96330:e=>{"use strict";e.exports=require("@prisma/client")},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},44870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},8755:(e,t,r)=>{"use strict";r.r(t),r.d(t,{patchFetch:()=>h,routeModule:()=>c,serverHooks:()=>m,workAsyncStorage:()=>d,workUnitAsyncStorage:()=>p});var s={};r.r(s),r.d(s,{GET:()=>u});var a=r(42706),n=r(28203),i=r(45994),o=r(39187),l=r(84908);async function u(e){try{let{searchParams:t}=new URL(e.url),r=t.get("q")||"",s=t.get("locale")||"en",a=parseInt(t.get("page")||"1",10),n=parseInt(t.get("limit")||"10",10),i=(a-1)*n;if(!r.trim())return o.NextResponse.json({results:[],total:0,page:a,limit:n});console.log(`Searching for "${r}" in locale "${s}"`);let u=await l.default.post.findMany({where:{status:{in:["PUBLISHED","ARCHIVED"]},translations:{some:{locale:s,OR:[{title:{contains:r,mode:"insensitive"}},{content:{contains:r,mode:"insensitive"}},{summary:{contains:r,mode:"insensitive"}}]}}},include:{translations:{where:{locale:s}},category:{include:{translations:{where:{locale:s}}}},author:{select:{firstName:!0,lastName:!0,firstNameArabic:!0,lastNameArabic:!0}},postAuthor:!0,media:{where:{type:"IMAGE",deletedAt:null},take:1}},orderBy:{publishedAt:{sort:"desc",nulls:"last"}},skip:i,take:n}),c=await l.default.post.count({where:{status:{in:["PUBLISHED","ARCHIVED"]},translations:{some:{locale:s,OR:[{title:{contains:r,mode:"insensitive"}},{content:{contains:r,mode:"insensitive"}},{summary:{contains:r,mode:"insensitive"}}]}}}});console.log(`Found ${u.length} matching posts out of ${c} total matches`);let d=u.map(e=>{let t=e.translations[0],r="";t?.content?(r=t.content.replace(/<[^>]*>/g," ").replace(/\s+/g," ").trim().substring(0,150)).length>=150&&(r+="..."):t?.summary&&(r=t.summary.replace(/<[^>]*>/g," ").trim());let a="";e.media&&e.media.length>0&&e.media[0].url&&(a=e.media[0].url);let n="";e.category?.translations?.length>0&&(n=e.category.translations[0].name);let i="";if(e.postAuthor){let t=e.postAuthor;i="ar"===s&&t.nameAr?t.nameAr:t.nameEn}else e.author&&(i="ar"===s&&(e.author.firstNameArabic||e.author.lastNameArabic)?`${e.author.firstNameArabic||""} ${e.author.lastNameArabic||""}`.trim():`${e.author.firstName||""} ${e.author.lastName||""}`.trim());return i||(i="Phoenix Staff"),{id:e.id,title:t?.title||`Post ${e.id}`,slug:t?.slug||e.id,excerpt:r,createdAt:e.createdAt.toISOString(),publishedAt:e.publishedAt?.toISOString()||e.createdAt.toISOString(),authorName:i,category:n?{name:n,slug:e.category.slug||""}:void 0,imageUrl:a,status:e.status}});return o.NextResponse.json({results:d,total:c,page:a,limit:n,query:r})}catch(e){return console.error("Search API error:",e),o.NextResponse.json({error:"An error occurred while searching"},{status:500})}}let c=new a.AppRouteRouteModule({definition:{kind:n.RouteKind.APP_ROUTE,page:"/api/search/route",pathname:"/api/search",filename:"route",bundlePath:"app/api/search/route"},resolvedPagePath:"D:\\press\\src\\app\\api\\search\\route.ts",nextConfigOutput:"standalone",userland:s}),{workAsyncStorage:d,workUnitAsyncStorage:p,serverHooks:m}=c;function h(){return(0,i.patchFetch)({workAsyncStorage:d,workUnitAsyncStorage:p})}},96487:()=>{},78335:()=>{},84908:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>n,prisma:()=>a});var s=r(96330);let a=global.prisma||new s.PrismaClient({log:["query","error","warn"]}),n=a}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[638,5452],()=>r(8755));module.exports=s})();