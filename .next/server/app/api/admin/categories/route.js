"use strict";(()=>{var e={};e.id=5714,e.ids=[5714],e.modules={96330:e=>{e.exports=require("@prisma/client")},10846:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},44870:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},3295:e=>{e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},29294:e=>{e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},63033:e=>{e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},55511:e=>{e.exports=require("crypto")},4573:e=>{e.exports=require("node:buffer")},77598:e=>{e.exports=require("node:crypto")},57975:e=>{e.exports=require("node:util")},66061:(e,t,r)=>{r.r(t),r.d(t,{patchFetch:()=>m,routeModule:()=>h,serverHooks:()=>f,workAsyncStorage:()=>y,workUnitAsyncStorage:()=>w});var a={};r.r(a),r.d(a,{GET:()=>p,POST:()=>g});var s=r(42706),n=r(28203),i=r(45994),o=r(39187),l=r(24018),d=r(60399);let c=new l.M,u=new d.u;async function p(e){try{if(!await u.hasPermission(e,"view_categories"))return o.NextResponse.json({error:"Unauthorized"},{status:403});let{searchParams:t}=new URL(e.url),r=t.get("locale"),a="true"===t.get("flat"),s=parseInt(t.get("page")||"1"),n=parseInt(t.get("limit")||"10"),i=t.get("search")||"";if(a){let e=await c.getAllFlat();return o.NextResponse.json(e)}let l=await c.getPaginated({locale:r||void 0,page:s,limit:n,search:i});return o.NextResponse.json(l)}catch(e){return console.error("Error fetching categories:",e),o.NextResponse.json({error:"Failed to fetch categories"},{status:500})}}async function g(e){try{if(!await u.hasPermission(e,"create_categories"))return o.NextResponse.json({error:"Unauthorized"},{status:403});let t=await e.json(),r=await c.create(t);return o.NextResponse.json(r,{status:201})}catch(e){return console.error("Error creating category:",e),o.NextResponse.json({error:e.message||"Failed to create category"},{status:400})}}let h=new s.AppRouteRouteModule({definition:{kind:n.RouteKind.APP_ROUTE,page:"/api/admin/categories/route",pathname:"/api/admin/categories",filename:"route",bundlePath:"app/api/admin/categories/route"},resolvedPagePath:"D:\\press\\src\\app\\api\\admin\\categories\\route.ts",nextConfigOutput:"standalone",userland:a}),{workAsyncStorage:y,workUnitAsyncStorage:w,serverHooks:f}=h;function m(){return(0,i.patchFetch)({workAsyncStorage:y,workUnitAsyncStorage:w})}},24018:(e,t,r)=>{r.d(t,{M:()=>n});var a=r(22565),s=r(84908);class n extends a.d{constructor(){super(s.default,s.default.category,[])}async create(e){if(!e.translations||0===e.translations.length)throw Error("At least one translation is required");for(let t of e.translations)if(await this.prisma.categoryTranslation.findUnique({where:{slug:t.slug}}))throw Error(`Slug '${t.slug}' already exists`);return this.prisma.category.create({data:{parentId:e.parentId||null,order:e.order||0,translations:{create:e.translations}},include:{translations:!0}})}async getAll(e){let t=await this.prisma.category.findMany({where:{deletedAt:null},include:{translations:!0,children:{include:{translations:!0}},parent:{include:{translations:!0}}},orderBy:[{order:"asc"},{createdAt:"desc"}]});return e&&t.forEach(t=>{t.translations=t.translations.filter(t=>t.locale===e)}),t.filter(e=>!e.parentId)}async getAllFlat(){return this.prisma.category.findMany({where:{deletedAt:null},include:{translations:!0,parent:{include:{translations:!0}}},orderBy:[{order:"asc"},{createdAt:"desc"}]})}async getById(e){return this.prisma.category.findUnique({where:{id:e},include:{translations:!0,parent:{include:{translations:!0}},children:{include:{translations:!0}}}})}async getBySlug(e){let t=await this.prisma.categoryTranslation.findUnique({where:{slug:e},include:{category:{include:{translations:!0,parent:{include:{translations:!0}},children:{include:{translations:!0}}}}}});return t?t.category:null}async update(e,t){let r=await this.prisma.category.findUnique({where:{id:e},include:{translations:!0}});if(!r)throw Error(`Category with ID ${e} not found`);if(await this.prisma.category.update({where:{id:e},data:{parentId:t.parentId,order:t.order}}),t.translations&&t.translations.length>0)for(let a of t.translations){let t=r.translations.find(e=>e.locale===a.locale);if(t){if(a.slug!==t.slug&&await this.prisma.categoryTranslation.findUnique({where:{slug:a.slug}}))throw Error(`Slug '${a.slug}' already exists`);await this.prisma.categoryTranslation.update({where:{id:t.id},data:a})}else{if(await this.prisma.categoryTranslation.findUnique({where:{slug:a.slug}}))throw Error(`Slug '${a.slug}' already exists`);await this.prisma.categoryTranslation.create({data:{...a,categoryId:e}})}}return this.getById(e)}async softDelete(e){if((await this.prisma.category.findMany({where:{parentId:e}})).length>0)throw Error("Cannot delete a category with children. Please delete or reassign the children first.");if((await this.prisma.post.findMany({where:{categoryId:e}})).length>0)throw Error("Cannot delete a category with posts. Please reassign the posts first.");return this.prisma.category.update({where:{id:e},data:{deletedAt:new Date}})}async hardDelete(e){if((await this.prisma.category.findMany({where:{parentId:e}})).length>0)throw Error("Cannot delete a category with children. Please delete or reassign the children first.");if((await this.prisma.post.findMany({where:{categoryId:e}})).length>0)throw Error("Cannot delete a category with posts. Please reassign the posts first.");return await this.prisma.categoryTranslation.deleteMany({where:{categoryId:e}}),this.prisma.category.delete({where:{id:e}})}async reorder(e){await Promise.all(e.map((e,t)=>this.prisma.category.update({where:{id:e},data:{order:t}})))}async getPaginated(e){let{locale:t,page:r=1,limit:a=10,search:s=""}=e||{},n={deletedAt:null,...s?{translations:{some:{OR:[{name:{contains:s,mode:"insensitive"}},{description:{contains:s,mode:"insensitive"}},{slug:{contains:s,mode:"insensitive"}}]}}}:{}},i=await this.prisma.category.count({where:n}),o=await this.prisma.category.findMany({where:n,include:{translations:!t||{where:{locale:t}},parent:{include:{translations:!t||{where:{locale:t}}}},children:{include:{translations:!t||{where:{locale:t}}}},_count:{select:{posts:!0}}},orderBy:[{order:"asc"},{createdAt:"desc"}],skip:(r-1)*a,take:a}),l=Math.ceil(i/a);return{categories:o,total:i,pages:l,page:r,limit:a}}}}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),a=t.X(0,[638,5452,4512,4926,7031,5371],()=>r(66061));module.exports=a})();