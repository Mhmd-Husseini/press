"use strict";(()=>{var e={};e.id=418,e.ids=[418],e.modules={96330:e=>{e.exports=require("@prisma/client")},10846:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},44870:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},3295:e=>{e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},29294:e=>{e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},63033:e=>{e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},55511:e=>{e.exports=require("crypto")},4573:e=>{e.exports=require("node:buffer")},77598:e=>{e.exports=require("node:crypto")},57975:e=>{e.exports=require("node:util")},61454:(e,r,t)=>{t.r(r),t.d(r,{patchFetch:()=>f,routeModule:()=>h,serverHooks:()=>w,workAsyncStorage:()=>g,workUnitAsyncStorage:()=>y});var a={};t.r(a),t.d(a,{POST:()=>p});var s=t(42706),n=t(28203),i=t(45994),o=t(39187),d=t(24018),l=t(60399);let c=new d.M,u=new l.u;async function p(e){try{if(!await u.hasPermission(e,"update_categories"))return o.NextResponse.json({error:"Unauthorized"},{status:403});let r=await e.json();if(!r.categoryIds||!Array.isArray(r.categoryIds))return o.NextResponse.json({error:"Invalid request format. categoryIds array is required."},{status:400});return await c.reorder(r.categoryIds),o.NextResponse.json({success:!0})}catch(e){return console.error("Error reordering categories:",e),o.NextResponse.json({error:e.message||"Failed to reorder categories"},{status:400})}}let h=new s.AppRouteRouteModule({definition:{kind:n.RouteKind.APP_ROUTE,page:"/api/admin/categories/reorder/route",pathname:"/api/admin/categories/reorder",filename:"route",bundlePath:"app/api/admin/categories/reorder/route"},resolvedPagePath:"D:\\press\\src\\app\\api\\admin\\categories\\reorder\\route.ts",nextConfigOutput:"standalone",userland:a}),{workAsyncStorage:g,workUnitAsyncStorage:y,serverHooks:w}=h;function f(){return(0,i.patchFetch)({workAsyncStorage:g,workUnitAsyncStorage:y})}},24018:(e,r,t)=>{t.d(r,{M:()=>n});var a=t(22565),s=t(84908);class n extends a.d{constructor(){super(s.default,s.default.category,[])}async create(e){if(!e.translations||0===e.translations.length)throw Error("At least one translation is required");for(let r of e.translations)if(await this.prisma.categoryTranslation.findUnique({where:{slug:r.slug}}))throw Error(`Slug '${r.slug}' already exists`);return this.prisma.category.create({data:{parentId:e.parentId||null,order:e.order||0,translations:{create:e.translations}},include:{translations:!0}})}async getAll(e){let r=await this.prisma.category.findMany({where:{deletedAt:null},include:{translations:!0,children:{include:{translations:!0}},parent:{include:{translations:!0}}},orderBy:[{order:"asc"},{createdAt:"desc"}]});return e&&r.forEach(r=>{r.translations=r.translations.filter(r=>r.locale===e)}),r.filter(e=>!e.parentId)}async getAllFlat(){return this.prisma.category.findMany({where:{deletedAt:null},include:{translations:!0,parent:{include:{translations:!0}}},orderBy:[{order:"asc"},{createdAt:"desc"}]})}async getById(e){return this.prisma.category.findUnique({where:{id:e},include:{translations:!0,parent:{include:{translations:!0}},children:{include:{translations:!0}}}})}async getBySlug(e){let r=await this.prisma.categoryTranslation.findUnique({where:{slug:e},include:{category:{include:{translations:!0,parent:{include:{translations:!0}},children:{include:{translations:!0}}}}}});return r?r.category:null}async update(e,r){let t=await this.prisma.category.findUnique({where:{id:e},include:{translations:!0}});if(!t)throw Error(`Category with ID ${e} not found`);if(await this.prisma.category.update({where:{id:e},data:{parentId:r.parentId,order:r.order}}),r.translations&&r.translations.length>0)for(let a of r.translations){let r=t.translations.find(e=>e.locale===a.locale);if(r){if(a.slug!==r.slug&&await this.prisma.categoryTranslation.findUnique({where:{slug:a.slug}}))throw Error(`Slug '${a.slug}' already exists`);await this.prisma.categoryTranslation.update({where:{id:r.id},data:a})}else{if(await this.prisma.categoryTranslation.findUnique({where:{slug:a.slug}}))throw Error(`Slug '${a.slug}' already exists`);await this.prisma.categoryTranslation.create({data:{...a,categoryId:e}})}}return this.getById(e)}async softDelete(e){if((await this.prisma.category.findMany({where:{parentId:e}})).length>0)throw Error("Cannot delete a category with children. Please delete or reassign the children first.");if((await this.prisma.post.findMany({where:{categoryId:e}})).length>0)throw Error("Cannot delete a category with posts. Please reassign the posts first.");return this.prisma.category.update({where:{id:e},data:{deletedAt:new Date}})}async hardDelete(e){if((await this.prisma.category.findMany({where:{parentId:e}})).length>0)throw Error("Cannot delete a category with children. Please delete or reassign the children first.");if((await this.prisma.post.findMany({where:{categoryId:e}})).length>0)throw Error("Cannot delete a category with posts. Please reassign the posts first.");return await this.prisma.categoryTranslation.deleteMany({where:{categoryId:e}}),this.prisma.category.delete({where:{id:e}})}async reorder(e){await Promise.all(e.map((e,r)=>this.prisma.category.update({where:{id:e},data:{order:r}})))}async getPaginated(e){let{locale:r,page:t=1,limit:a=10,search:s=""}=e||{},n={deletedAt:null,...s?{translations:{some:{OR:[{name:{contains:s,mode:"insensitive"}},{description:{contains:s,mode:"insensitive"}},{slug:{contains:s,mode:"insensitive"}}]}}}:{}},i=await this.prisma.category.count({where:n}),o=await this.prisma.category.findMany({where:n,include:{translations:!r||{where:{locale:r}},parent:{include:{translations:!r||{where:{locale:r}}}},children:{include:{translations:!r||{where:{locale:r}}}},_count:{select:{posts:!0}}},orderBy:[{order:"asc"},{createdAt:"desc"}],skip:(t-1)*a,take:a}),d=Math.ceil(i/a);return{categories:o,total:i,pages:d,page:t,limit:a}}}}};var r=require("../../../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),a=r.X(0,[638,5452,4512,4926,7031,5371],()=>t(61454));module.exports=a})();