"use strict";(()=>{var e={};e.id=7746,e.ids=[7746],e.modules={96330:e=>{e.exports=require("@prisma/client")},10846:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},44870:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},3295:e=>{e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},29294:e=>{e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},63033:e=>{e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},55511:e=>{e.exports=require("crypto")},4573:e=>{e.exports=require("node:buffer")},77598:e=>{e.exports=require("node:crypto")},57975:e=>{e.exports=require("node:util")},98279:(e,r,s)=>{s.r(r),s.d(r,{patchFetch:()=>g,routeModule:()=>f,serverHooks:()=>y,workAsyncStorage:()=>h,workUnitAsyncStorage:()=>x});var i={};s.r(i),s.d(i,{GET:()=>c,POST:()=>m});var n=s(42706),t=s(28203),o=s(45994),a=s(39187),p=s(28009),u=s(60399);let l=new p.n,d=new u.u;async function c(e){try{let r=await d.getCurrentUser();console.log("Current user from authService:",r?{id:r.id,email:r.email,roles:r.roles.map(e=>e.role.name)}:null);let s=e.cookies.get("auth-token")?.value;if(console.log("Token found in cookies:",!!s),s)try{let e=await d.verifyToken(s);if(console.log("JWT token payload:",e),e){let r=e.roles||[];if(Array.isArray(r)&&(r.includes("ADMIN")||r.includes("SUPER_ADMIN"))){console.log("User has admin role in token, bypassing permission check");let e=await l.getAll();return a.NextResponse.json(e)}}else console.log("Token verification failed - decoded payload is null")}catch(e){console.error("Error decoding token:",e)}else console.log("No auth token found in cookies");let i=await d.hasPermission("view_permissions");if(console.log("Has view_permissions permission:",i),!i)return a.NextResponse.json({error:"Unauthorized: Insufficient permissions"},{status:403});let n=await l.getAll();return a.NextResponse.json(n)}catch(e){return console.error("Error fetching permissions:",e),a.NextResponse.json({error:"Failed to fetch permissions"},{status:500})}}async function m(e){try{if(!await d.hasPermission("create_permissions"))return a.NextResponse.json({error:"Unauthorized: Insufficient permissions"},{status:403});let r=await e.json();if(!r.name)return a.NextResponse.json({error:"Permission name is required"},{status:400});let s=await l.create({name:r.name,nameArabic:r.nameArabic,description:r.description,descriptionArabic:r.descriptionArabic});return a.NextResponse.json(s,{status:201})}catch(e){if(console.error("Error creating permission:",e),e instanceof Error&&e.message.includes("already exists"))return a.NextResponse.json({error:e.message},{status:409});return a.NextResponse.json({error:"Failed to create permission"},{status:500})}}let f=new n.AppRouteRouteModule({definition:{kind:t.RouteKind.APP_ROUTE,page:"/api/admin/permissions/route",pathname:"/api/admin/permissions",filename:"route",bundlePath:"app/api/admin/permissions/route"},resolvedPagePath:"D:\\press\\src\\app\\api\\admin\\permissions\\route.ts",nextConfigOutput:"standalone",userland:i}),{workAsyncStorage:h,workUnitAsyncStorage:x,serverHooks:y}=f;function g(){return(0,o.patchFetch)({workAsyncStorage:h,workUnitAsyncStorage:x})}},28009:(e,r,s)=>{s.d(r,{n:()=>t});var i=s(22565),n=s(84908);class t extends i.d{constructor(){super(n.default,n.default.permission,[])}async create(e){if(await this.prisma.permission.findUnique({where:{name:e.name}}))throw Error(`Permission '${e.name}' already exists`);return this.prisma.permission.create({data:e})}async findByName(e){return this.prisma.permission.findUnique({where:{name:e}})}async findById(e){return this.prisma.permission.findUnique({where:{id:e}})}async getAll(){return this.prisma.permission.findMany({orderBy:{name:"asc"}})}async update(e,r){return this.prisma.permission.update({where:{id:e},data:r})}async delete(e){return await this.prisma.rolePermission.deleteMany({where:{permissionId:e}}),this.prisma.permission.delete({where:{id:e}})}}}};var r=require("../../../../webpack-runtime.js");r.C(e);var s=e=>r(r.s=e),i=r.X(0,[638,5452,4512,4926,7031,5371],()=>s(98279));module.exports=i})();