(()=>{var e={};e.id=2708,e.ids=[2708],e.modules={96330:e=>{"use strict";e.exports=require("@prisma/client")},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},19121:e=>{"use strict";e.exports=require("next/dist/server/app-render/action-async-storage.external.js")},3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},79428:e=>{"use strict";e.exports=require("buffer")},55511:e=>{"use strict";e.exports=require("crypto")},33873:e=>{"use strict";e.exports=require("path")},27910:e=>{"use strict";e.exports=require("stream")},79551:e=>{"use strict";e.exports=require("url")},28354:e=>{"use strict";e.exports=require("util")},67815:(e,r,t)=>{"use strict";t.r(r),t.d(r,{GlobalError:()=>n.a,__next_app__:()=>u,pages:()=>l,routeModule:()=>p,tree:()=>d});var s=t(70260),a=t(28203),i=t(25155),n=t.n(i),o=t(67292),c={};for(let e in o)0>["default","tree","pages","GlobalError","__next_app__","routeModule"].indexOf(e)&&(c[e]=()=>o[e]);t.d(r,c);let d=["",{children:["admin",{children:["users",{children:["new",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(t.bind(t,57467)),"D:\\press\\src\\app\\admin\\users\\new\\page.tsx"]}]},{}]},{}]},{layout:[()=>Promise.resolve().then(t.bind(t,85798)),"D:\\press\\src\\app\\admin\\layout.tsx"],metadata:{icon:[async e=>(await Promise.resolve().then(t.bind(t,70440))).default(e)],apple:[],openGraph:[],twitter:[],manifest:void 0}}]},{layout:[()=>Promise.resolve().then(t.bind(t,71354)),"D:\\press\\src\\app\\layout.tsx"],"not-found":[()=>Promise.resolve().then(t.t.bind(t,19937,23)),"next/dist/client/components/not-found-error"],forbidden:[()=>Promise.resolve().then(t.t.bind(t,69116,23)),"next/dist/client/components/forbidden-error"],unauthorized:[()=>Promise.resolve().then(t.t.bind(t,41485,23)),"next/dist/client/components/unauthorized-error"],metadata:{icon:[async e=>(await Promise.resolve().then(t.bind(t,70440))).default(e)],apple:[],openGraph:[],twitter:[],manifest:void 0}}],l=["D:\\press\\src\\app\\admin\\users\\new\\page.tsx"],u={require:t,loadChunk:()=>Promise.resolve()},p=new s.AppPageRouteModule({definition:{kind:a.RouteKind.APP_PAGE,page:"/admin/users/new/page",pathname:"/admin/users/new",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:d}})},51580:(e,r,t)=>{"use strict";t.r(r),t.d(r,{"007ef74b69aebf12238ea651195ddc937e58ae17f8":()=>s.HW,"00d4248e5cc13d9a24c27da7f63c4e748a633f8d0d":()=>s.ri,"4050a74c93af136bf3a3faa21dd4a4d846bc6cf489":()=>s.kz,"406c6ae9fdbd8fde4bc076808d36b31662aa903d10":()=>h,"4088416fcca4e2f0fd31c02635f52bcd85eb0c7428":()=>x,"408e655556292a0a94341763d8193fda605da02beb":()=>s.iD,"40bfc4f08e4990765ebb050f59da905b6a735b35b7":()=>v,"40d9017b028a04aceb55dc0703bb229a5931508547":()=>w,"70bcc105acf56993e9fa771860505741269129801f":()=>g});var s=t(90119),a=t(21590);t(70376);var i=t(16500),n=t(47735);class o{constructor(e){this.query={},this.searchFields=[],this.searchFields=e}paginate(e){let r=Number(e.page)||1,t=Number(e.limit)||10;return{take:t,skip:(r-1)*t}}sort(e){return e.sortBy?{orderBy:{[e.sortBy]:e.sortOrder||"desc"}}:{}}search(e){return e.search?{OR:this.searchFields.map(r=>({[r]:{contains:e.search,mode:"insensitive"}}))}:{}}filter(e){return e.filters?{AND:Object.entries(e.filters).map(([e,r])=>({[e]:r}))}:{}}build(e){return{where:{...this.search(e),...this.filter(e)},...this.paginate(e),...this.sort(e)}}}class c{constructor(e,r,t){this.prisma=e,this.model=r,this.searchFields=t}async findAll(e){let r=new o(this.searchFields).build(e),[t,s]=await Promise.all([this.model.findMany(r),this.model.count({where:r.where})]);return{data:t,meta:{total:s,page:Number(e.page)||1,limit:Number(e.limit)||10,totalPages:Math.ceil(s/(Number(e.limit)||10))}}}}var d=t(80541),l=t(10267);class u extends c{constructor(){super(d.A,d.A.user,["email","firstName","lastName","firstNameArabic","lastNameArabic"].map(e=>`${e}`))}async create(e,r=["USER"]){if(await this.prisma.user.findUnique({where:{email:e.email}}))throw Error("User with this email already exists");let t=await l.Ay.hash(e.password,10);return this.prisma.user.create({data:{...e,password:t,roles:{create:r.map(e=>({role:{connectOrCreate:{where:{name:e},create:{name:e}}}}))}},include:{roles:{include:{role:!0}}}})}async findById(e){return this.prisma.user.findUnique({where:{id:e},include:{roles:{include:{role:!0}}}})}async update(e,r,t){r.password&&(r.password=await l.Ay.hash(r.password,10));let s=await this.prisma.user.update({where:{id:e},data:r,include:{roles:{include:{role:!0}}}});return t&&t.length>0?(await this.prisma.userRole.deleteMany({where:{userId:e}}),await Promise.all(t.map(async r=>{let t=await this.prisma.role.findUnique({where:{name:r}});if(t)return this.prisma.userRole.create({data:{userId:e,roleId:t.id}})})),this.prisma.user.findUnique({where:{id:e},include:{roles:{include:{role:!0}}}})):s}async delete(e){return await this.prisma.userRole.deleteMany({where:{userId:e}}),this.prisma.user.delete({where:{id:e}})}}var p=t(99344);let m=i.z.object({email:i.z.string().email(),firstName:i.z.string().min(1),lastName:i.z.string().min(1),password:i.z.string().min(6),languagePreference:i.z.string().optional(),firstNameArabic:i.z.string().optional(),lastNameArabic:i.z.string().optional(),bioArabic:i.z.string().optional(),bio:i.z.string().optional(),avatar:i.z.string().optional(),isActive:i.z.boolean().optional().default(!0)}),f=m.partial().omit({password:!0}).extend({id:i.z.string(),password:i.z.string().min(6).optional()}),b=new u;async function h(e){try{let r={email:e.get("email"),firstName:e.get("firstName"),lastName:e.get("lastName"),password:e.get("password"),firstNameArabic:e.get("firstNameArabic"),lastNameArabic:e.get("lastNameArabic"),bio:e.get("bio"),bioArabic:e.get("bioArabic"),avatar:e.get("avatar"),languagePreference:e.get("languagePreference"),isActive:"true"===e.get("isActive")},t=m.parse(r),s=e.get("roles"),a=s?s.split(","):["USER"],{password:i,...o}=await b.create(t,a);return(0,n.revalidatePath)("/admin/users"),{success:!0,user:o}}catch(e){if(console.error("Error creating user:",e),e instanceof i.z.ZodError)return{success:!1,error:e.errors.map(e=>e.message).join(", ")};return{success:!1,error:e instanceof Error?e.message:"Failed to create user"}}}async function g(e=1,r=10,t){try{let s=await b.findAll({page:e,limit:r,search:t,sortBy:"createdAt",sortOrder:"desc"}),a=s.data.map(e=>{let{password:r,...t}=e;return t});return{success:!0,users:a,meta:s.meta}}catch(e){return console.error("Error getting users:",e),{success:!1,error:"Failed to retrieve users"}}}async function w(e){try{let r=await b.findById(e);if(!r)return{success:!1,error:"User not found"};let{password:t,...s}=r;return{success:!0,user:s}}catch(e){return console.error("Error getting user:",e),{success:!1,error:"Failed to retrieve user"}}}async function v(e){try{let r=e.get("id");if(!r)return{success:!1,error:"User ID is required"};if(!await b.findById(r))return{success:!1,error:"User not found"};let t={id:r,email:e.get("email"),firstName:e.get("firstName"),lastName:e.get("lastName"),password:e.get("password")||void 0,firstNameArabic:e.get("firstNameArabic"),lastNameArabic:e.get("lastNameArabic"),bio:e.get("bio"),bioArabic:e.get("bioArabic"),avatar:e.get("avatar"),languagePreference:e.get("languagePreference"),isActive:"true"===e.get("isActive")},{id:s,...a}=f.parse(t),i={...a};void 0===i.password&&delete i.password;let o=e.get("roles"),c=o?o.split(","):void 0,{password:d,...l}=await b.update(r,i,c);return(0,n.revalidatePath)("/admin/users"),(0,n.revalidatePath)(`/admin/users/${r}`),{success:!0,user:l}}catch(e){if(console.error("Error updating user:",e),e instanceof i.z.ZodError)return{success:!1,error:e.errors.map(e=>e.message).join(", ")};return{success:!1,error:"Failed to update user"}}}async function x(e){try{return await b.delete(e),(0,n.revalidatePath)("/admin/users"),{success:!0}}catch(e){return console.error("Error deleting user:",e),{success:!1,error:"Failed to delete user"}}}(0,p.D)([h,g,w,v,x]),(0,a.A)(h,"406c6ae9fdbd8fde4bc076808d36b31662aa903d10",null),(0,a.A)(g,"70bcc105acf56993e9fa771860505741269129801f",null),(0,a.A)(w,"40d9017b028a04aceb55dc0703bb229a5931508547",null),(0,a.A)(v,"40bfc4f08e4990765ebb050f59da905b6a735b35b7",null),(0,a.A)(x,"4088416fcca4e2f0fd31c02635f52bcd85eb0c7428",null)},51462:(e,r,t)=>{Promise.resolve().then(t.bind(t,57467))},21198:(e,r,t)=>{Promise.resolve().then(t.bind(t,7655))},7655:(e,r,t)=>{"use strict";t.r(r),t.d(r,{default:()=>u});var s=t(45512),a=t(26248);let i=(0,a.createServerReference)("406c6ae9fdbd8fde4bc076808d36b31662aa903d10",a.callServer,void 0,a.findSourceMapURL,"createUser");var n=t(86668),o=t(79334),c=t(84824),d=t(28531),l=t.n(d);function u(){(0,o.useRouter)();let e=(0,s.jsxs)("div",{className:"bg-red-50 border border-red-200 text-red-700 px-6 py-8 rounded-lg text-center",children:[(0,s.jsx)("h3",{className:"text-lg font-medium",children:"Access Denied"}),(0,s.jsx)("p",{className:"mt-2",children:"You don't have permission to create new users."}),(0,s.jsx)(l(),{href:"/admin/users",className:"mt-4 inline-block text-blue-600 hover:underline",children:"Return to User Management"})]});return(0,s.jsx)(c.A,{roles:["SUPER_ADMIN","EDITOR_IN_CHIEF","EDITORIAL"],fallback:e,children:(0,s.jsxs)("div",{className:"space-y-6",children:[(0,s.jsx)("h1",{className:"text-2xl font-bold",children:"Create New User"}),(0,s.jsx)(n.A,{onSubmit:i,submitButtonText:"Create User"})]})})}},57467:(e,r,t)=>{"use strict";t.r(r),t.d(r,{default:()=>s});let s=(0,t(46760).registerClientReference)(function(){throw Error("Attempted to call the default export of \"D:\\\\press\\\\src\\\\app\\\\admin\\\\users\\\\new\\\\page.tsx\" from the server, but it's on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"D:\\press\\src\\app\\admin\\users\\new\\page.tsx","default")}};var r=require("../../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),s=r.X(0,[638,6154,3928,2367,4549,7735,574,4205],()=>t(67815));module.exports=s})();